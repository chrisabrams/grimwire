!function(){function e(e){return e&&"function"==typeof e.then}function t(e){this.succeedCBs=[],this.failCBs=[],this.__hasValue=!1,this.__hasFailed=!1,this.value=void 0,e&&this.fulfill(e)}function r(t,r,n){if(null===n)t.isRejected()?r.reject(t.value):r.fulfill(t.value);else{var o;try{o=n(t.value)}catch(i){i instanceof Error&&(console.error?console.error(i,i.stack):console.log("Promise exception thrown",i,i.stack)),r.reject(i)}e(o)?s(o).chain(r):r.fulfill(o)}}function n(e,t){Array.isArray(e)||(e=[e]);var r=s(),n=e.length,o=0;if(0===n)return r.fulfill([]),r;var i=[];i.length=n;for(var a=[],l=function(e,s,l){i[s]=e,l&&a.push(s),++o==n&&(t?t(i,a)?r.fulfill(i):r.reject(i):r.fulfill(i))},u=0;n>u;u++)s(e[u]).succeed(l,u,!1).fail(l,u,!0);return r}function o(e){return n(e,function(e,t){return 0===t.length})}function i(e){return n(e,function(e,t){return t.length<e.length})}function s(r){if(arguments.length>1)return n(Array.prototype.slice.call(arguments));if(r instanceof t)return r;if(e(r)){var o=s();return r.then(function(e){o.fulfill(e)},function(e){o.reject(e)}),o}return new t(r)}var a=this;"undefined"!=typeof window?("undefined"==typeof window.local&&(window.local={}),a=window.local):"undefined"!=typeof self?("undefined"==typeof self.local&&(self.local={}),a=self.local):"undefined"!=typeof module&&(a=module.exports),t.prototype.isUnfulfilled=function(){return!this.__hasValue},t.prototype.isRejected=function(){return this.__hasFailed},t.prototype.isFulfilled=function(){return this.__hasValue&&!this.__hasFailed},t.prototype.then=function(e,t){e=e&&"function"==typeof e?e:null,t=t&&"function"==typeof t?t:null;var n=s();if(this.isUnfulfilled())this.succeedCBs.push({p:n,fn:e}),this.failCBs.push({p:n,fn:t});else{var o=this;setTimeout(function(){o.isFulfilled()?r(o,n,e):r(o,n,t)},0)}return n},t.prototype.succeed=function(e){if(this.isRejected())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(function(r){return e.apply(null,[r].concat(t))})},t.prototype.fail=function(e){if(this.isFulfilled())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(null,function(r){return e.apply(null,[r].concat(t))})},t.prototype.always=function(e){return this.then(e,e)},t.prototype.fulfill=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0;for(var t=0;t<this.succeedCBs.length;t++){var n=this.succeedCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.reject=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0,this.__hasFailed=!0;for(var t=0;t<this.failCBs.length;t++){var n=this.failCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.cancel=function(){var e;for(e=0;e<this.succeedCBs.length;e++)this.succeedCBs[e].p.cancel();for(e=0;e<this.failCBs.length;e++)this.failCBs[e].p.cancel();return this.succeedCBs.length=0,this.failCBs.length=0,this},t.prototype.chain=function(e){return this.then(function(t){return s(e).fulfill(t),t},function(t){return s(e).reject(t),t}),e},t.prototype.cb=function(e,t){e?this.reject(e):this.fulfill("undefined"==typeof t?null:t)},a.Promise=t,a.promise=s,a.promise.bundle=n,a.promise.all=o,a.promise.any=i}(),"undefined"!=typeof define&&define([],function(){return Promise}),"undefined"==typeof this.local&&(this.local={}),"undefined"==typeof this.local.util&&(this.local.util={}),function(){function e(){Object.defineProperty(this,"_events",{value:{},configurable:!0,enumerable:!1})}e.prototype.emit=function(e){var t=this._events[e];if(!t)return!1;for(var r=Array.prototype.slice.call(arguments,1),n=0,o=t.length;o>n;n++)t[n].apply(this,r);return!0},e.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this.emit("newListener",e,t),this._events[e]?this._events[e].push(t):this._events[e]=[t],this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,t){var r=this;r.on(e,function n(){r.removeListener(e,n),t.apply(this,arguments)})},e.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e],n=r.indexOf(t);return 0>n?this:(r.splice(n,1),0===r.length&&delete this._events[e],this)},e.prototype.removeAllListeners=function(e){return e&&this._events[e]&&(this._events[e]=null),this},e.prototype.listeners=function(e){return this._events[e]},local.util.EventEmitter=e}(),"undefined"==typeof this.local&&(this.local={}),"undefined"==typeof this.local.http&&(this.local.http={}),"undefined"==typeof this.local.http.ext&&(this.local.http.ext={}),function(){function e(){}function t(e,t){if(!e||"object"!=typeof e||!t)return e;var r=i(t,"serializer");return r?r(e):e}function r(e,t){if(!e||"string"!=typeof e||!t)return e;var r=i(t,"deserializer");return r?r(e):e}function n(e,t,r){S[e]={serializer:t,deserializer:r}}function o(e){var t=e.split(";"),r=t[0];if(t=r.split("/"),t[1]){var n=t[1].split("+");return n[1]?[r,t[0]+"/"+n[1],t[0]]:[r,t[0]]}return[r]}function i(e,t){for(var r=o(e),n=0;n<r.length;n++)if(r[n]in S)return S[r[n]][t];return null}function s(e,t){t.status>=200&&t.status<400?e.fulfill(t):t.status>=400&&t.status<600||0===t.status?e.reject(t):e.fulfill(t)}function a(e,t){var r=C[e.urld.host];if(!r){var n=new h(404,"server not found");return t.reject(n),n.end(),void 0}var o={path:e.urld.path,method:e.method,query:e.query||{},headers:e.headers||{},body:e.body,stream:e.stream};if(o.path=o.path?o.path.replace(/(.)\/$/,"$1"):"/",e.urld.query){var i=local.http.contentTypes.deserialize(e.urld.query,"application/x-www-form-urlencoded");for(var s in i)o.query[s]=i[s]}r.fn.call(r.context,o,new f(t,e.stream))}function l(e,t){if(e.query){var r=local.http.contentTypes.serialize(e.query,"application/x-www-form-urlencoded");r&&(e.urld.query?(e.urld.query+="&"+r,e.urld.relative+="&"+r):(e.urld.query=r,e.urld.relative+="?"+r))}"undefined"!=typeof window?u(e,t):c(e,t)}function u(e,t){var r=(e.urld.protocol?e.urld.protocol+"://":"")+e.urld.authority+e.urld.relative;local.http.serializeRequestHeaders(e.headers),null!==e.body&&"undefined"!=typeof e.body&&(e.headers["content-type"]=e.headers["content-type"]||"application/json","string"!=typeof e.body&&(e.body=local.http.contentTypes.serialize(e.body,e.headers["content-type"])));var n=new XMLHttpRequest;n.open(e.method,r,!0);for(var o in e.headers)null!==e.headers[o]&&e.headers.hasOwnProperty(o)&&n.setRequestHeader(o,e.headers[o]);var i,a=0,l=0;n.onreadystatechange=function(){if(n.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!i){if(i=new h(n.status,n.statusText),i.on("close",function(){n.readyState!==XMLHttpRequest.DONE&&n.abort()}),n.getAllResponseHeaders())n.getAllResponseHeaders().split("\n").forEach(function(e){if(e){var t=e.toLowerCase().replace("\r","").split(": ");i.headers[t[0]]=t[1]}});else{var r=function(e){var t=n.getResponseHeader(e);t&&(i.headers[e.toLowerCase()]=t.toLowerCase())};r("Accept-Ranges"),r("Age"),r("Allow"),r("Cache-Control"),r("Connection"),r("Content-Encoding"),r("Content-Language"),r("Content-Length"),r("Content-Location"),r("Content-MD5"),r("Content-Disposition"),r("Content-Range"),r("Content-Type"),r("Date"),r("ETag"),r("Expires"),r("Last-Modified"),r("Link"),r("Location"),r("Pragma"),r("Refresh"),r("Retry-After"),r("Server"),r("Set-Cookie"),r("Trailer"),r("Transfer-Encoding"),r("Vary"),r("Via"),r("Warning"),r("WWW-Authenticate")}i.headers.link&&(i.headers.link=local.http.parseLinkHeader(i.headers.link)),e.stream&&(s(t,i),a=setInterval(function(){var e=n.responseText.length;e>l&&(l=e,i.write(n.responseText,!0))},e.streamPoll||500))}n.readyState===XMLHttpRequest.DONE&&(i=i||new h(n.status,n.statusText),a&&clearInterval(a),i.write(n.responseText,!0),i.end(),e.stream||s(t,i))},n.send(e.body)}function c(e,t){var r=new h(0,"dispatch() has not yet been implemented for nodejs");t.reject(r),r.end()}function p(e,t){for(var r=e.url.indexOf(":"),n=e.url.indexOf(","),o=e.url.slice(r+1,n).split(";"),i=o.shift(),s=!1;o.length;){var a=o.shift();"base64"==a&&(s=!0)}var l=e.url.slice(n+1);l||(l=""),l=s?atob(l):decodeURIComponent(l);var u=new f(t);u.writeHead(200,"ok",{"content-type":i}),u.end(l)}function h(e,t){local.util.EventEmitter.call(this),this.status=e,this.reason=t,this.headers={},this.body=null,this.isConnOpen=!0}function f(e,t){local.util.EventEmitter.call(this),this.resPromise=e,this.isStreaming=t,this.clientResponse=new h}function d(e){var t=new w(local.http.dispatch({method:"get",url:"httpl://"+e.urld.authority+e.urld.relative,headers:{accept:"text/event-stream"},stream:!0}));return t}function v(e){return"undefined"!=typeof window?y(e):m(e)}function y(e){var t=(e.urld.protocol||"http")+"://"+e.urld.authority+e.urld.relative;return new x(t)}function m(){throw"subscribe() has not yet been implemented for nodejs"}function g(){local.util.EventEmitter.call(this),this.isConnOpen=!0}function w(e){g.call(this),this.response=null;var t=this;e.then(function(e){t.response=e,e.on("data",function(e){t.__emitEvent(e)}),e.on("end",function(){t.close()})},function(e){t.__emitError({event:"error",data:e}),t.close()})}function x(e){g.call(this),this.eventSource=new EventSource(e);var t=this;this.eventSource.onerror=function(e){e.target.readyState==EventSource.CLOSED&&t.close()}}function b(){this.streams=[]}function L(){return"undefined"!=typeof window?window.location.host:app?app.config.environmentHost:""}function k(e,t,r){this.rel=e,this.relparams=t,this.url=r,this.resolveState=k.UNRESOLVED,this.error=null}function E(e,t){if(this.context=e||null,this.parentNavigator=t||null,this.links=null,"string"==typeof this.context)this.context=new k(null,null,e);else if(!t)throw"parentNavigator is required for navigators with relative contexts"}local.http.parseLinkHeader=function(e){return"string"!=typeof e?e:e.replace(/,[\s]*</g,"|||<").split("|||").map(function(e){var t={};return e.trim().split(";").forEach(function(e){if(e=e.trim())if("<"===e.charAt(0))t.href=e.trim().slice(1,-1);else{var r=e.split("="),n=r[0].trim(),o=r[1].trim().slice(1,-1);t[n]=o}}),t})},local.http.lookupLink=function(e,t,r){var n=e?e.length:0;if(!n)return null;r&&(r=r.toLowerCase());for(var o=null,i=0;n>i;i++){var s=e[i];if(s&&s.rel&&-1!==s.rel.indexOf(t))if(r&&s.title){if(s.title.toLowerCase()===r){o=s;break}}else o=s}return o?o.href:null},local.http.joinUrl=function(){var e=Array.prototype.map.call(arguments,function(e){var t=0,r=e.length;return"/"===e.charAt(0)&&(t+=1),"/"===e.charAt(r-1)&&(r-=1),e.substring(t,r)});return e.join("/")},local.http.serializeRequestHeaders=function(e){if(e.authorization&&"object"==typeof e.authorization){if(!e.authorization.scheme)throw"`scheme` required for auth headers";var t;switch(e.authorization.scheme.toLowerCase()){case"basic":t="Basic "+btoa(e.authorization.name+":"+e.authorization.password);break;case"persona":t="Persona name="+e.authorization.name+" assertion="+e.authorization.assertion;break;default:throw"unknown auth sceme: "+e.authorization.scheme}e.authorization=t}},local.http.parseUri=function(e){"object"==typeof e&&(e.url?e=e.url:(e.host||e.path)&&(e=local.http.joinUrl(req.host,req.path)));for(var t=local.http.parseUri.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},o=14;o--;)n[t.key[o]]=r[o]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,function(e,r,o){r&&(n[t.q.name][r]=o)}),n},local.http.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},local.http.pipe=function(e,t,r,n){return r=r||function(e){return e},n=n||function(e){return e},local.promise(t).succeed(function(t){return e.status||e.writeHead(t.status,t.reason,r(t.headers)),null!==t.body&&"undefined"!=typeof t.body&&e.write(n(t.body)),t.on&&t.isConnOpen?(t.on("data",function(t){e.write(n(t))}),t.on("end",function(){e.end()})):e.end(),e}).fail(function(t){var r=t.headers["content-type"]||"text/plain",n=r&&t.body?t.body:"";throw e.writeHead(502,"bad gateway",{"content-type":r}),e.end(n),t})};var A={serialize:t,deserialize:r,register:n},S={};local.http.contentTypes=A,local.http.contentTypes.register("application/json",function(e){try{return JSON.stringify(e)}catch(t){return t.message}},function(e){try{return JSON.parse(e)}catch(t){return t.message}}),local.http.contentTypes.register("application/x-www-form-urlencoded",function(e){var t=encodeURIComponent,r=[];for(var n in e)if(null===e[n])r.push(n+"=");else if(Array.isArray(e[n]))for(var o=0;o<e[n].length;o++)r.push(n+"[]="+t(e[n][o]));else if("object"==typeof e[n])for(var i in e[n])r.push(n+"["+i+"]="+t(e[n][i]));else r.push(n+"="+t(e[n]));return r.join("&")},function(e){for(var t=e.split("&"),r={},n=0;n<t.length;n++){var o=t[n].split("="),i=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),a=/\[\]$/.test(i),l=i.match(/^(.+)\[([^\]]+)\]$/);if(l){i=l[1];var u=l[2];r[i]=r[i]||{},r[i][u]=s}else a?(i=i.substring(0,i.length-2),r[i]=r[i]||[],r[i].push(s)):r[i]=s}return r});var C={},R=null,j="undefined"!=typeof window?window.location.pathname.split("/"):[""];j[j.length-1]="",j=j.join("/"),local.http.dispatch=function(e){if(!e)throw"no req param provided to request";if(e.headers=e.headers||{},e.query=e.query||{},e.method=e.method?e.method.toUpperCase():"GET",R)return R(e);if(e.url||(e.url=local.http.joinUrl(e.host,e.path)),e.urld||(e.urld=local.http.parseUri(e.url)),!e.urld)throw"no URL or host/path provided in request";e.urld.protocol||(e.url=e.url.length>0&&"/"!=e.url.charAt(0)?window.location.protocol+"//"+window.location.host+j+e.url:window.location.protocol+"//"+window.location.host+e.url,e.urld=local.http.parseUri(e.url));var t=local.promise();if("httpl"==e.urld.protocol)setTimeout(function(){a(e,t)},0);else if("http"==e.urld.protocol||"https"==e.urld.protocol)setTimeout(function(){l(e,t)},0);else if("data"==e.urld.protocol)setTimeout(function(){p(e,t)},0);else{var r=new h(0,'unsupported protocol "'+e.urld.protocol+'"');t.reject(r),r.end()}return t},local.http.setRequestDispatcher=function(e){R=e},local.http.ClientResponse=h,h.prototype=Object.create(local.util.EventEmitter.prototype),h.prototype.write=function(e,t){if(this.isConnOpen){if(t||"string"!=typeof e||"string"!=typeof this.body){var r=this.body&&"string"==typeof this.body?this.body.length:0;this.body=e,e="string"==typeof e?e.slice(r):e}else this.body+=e;this.emit("data",e)}},h.prototype.end=function(){this.isConnOpen&&(this.__deserialize(),this.isConnOpen=!1,this.emit("end"),this.close())},h.prototype.close=function(){this.isConnOpen&&(this.isConnOpen=!1,this.emit("close"),this.removeAllListeners("data"),this.removeAllListeners("end"),this.removeAllListeners("close"))},h.prototype.__deserialize=function(){"string"==typeof this.body&&(this.body=local.http.contentTypes.deserialize(this.body,this.headers["content-type"]))},local.http.ServerResponse=f,f.prototype=Object.create(local.util.EventEmitter.prototype),f.prototype.writeHead=function(e,t,r){if(this.clientResponse.status=e,this.clientResponse.reason=t,r)for(var n in r)r.hasOwnProperty(n)&&this.setHeader(n,r[n]);return this.isStreaming&&s(this.resPromise,this.clientResponse),this},f.prototype.setHeader=function(e,t){this.clientResponse.headers[e]=t},f.prototype.getHeader=function(e){return this.clientResponse.headers[e]},f.prototype.removeHeader=function(e){delete this.clientResponse.headers[e]},f.prototype.write=function(e){return this.clientResponse.write(e,!1),this},f.prototype.end=function(e){return e&&this.write(e),this.clientResponse.end(),this.emit("close"),this.removeAllListeners("close"),this.isStreaming||s(this.resPromise,this.clientResponse),this},f.prototype.writeContinue=e,f.prototype.addTrailers=e,f.prototype.sendDate=e,local.http.registerLocal=function(e,t,r){var n=local.http.parseUri(e);if(n.protocol&&"httpl"!==n.protocol)throw"registerLocal can only add servers to the httpl protocol";if(!n.host)throw"invalid domain provided to registerLocal";if(C[n.host])throw"server already registered at domain given to registerLocal";C[n.host]={fn:t,context:r}},local.http.unregisterLocal=function(e){var t=local.http.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";C[t.host]&&delete C[t.host]},local.http.getLocal=function(e){var t=local.http.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";return C[t.host]},local.http.getLocalRegistry=function(){return C};var j="undefined"!=typeof window?window.location.pathname.split("/"):[""];j[j.length-1]="",j=j.join("/");var _=null;local.http.subscribe=function(e){if(!e)throw"no options provided to subscribe";if("string"==typeof e&&(e={url:e}),_)return _(e);if(e.url||(e.url=local.http.joinUrl(e.host,e.path)),e.urld=local.http.parseUri(e.url),!e.urld)throw"no URL or host/path provided in request";return e.urld.protocol||(e.url=e.url.length>0&&"/"!=e.url.charAt(0)?window.location.protocol+"//"+window.location.host+j+e.url:window.location.protocol+"//"+window.location.host+e.url,e.urld=local.http.parseUri(e.url)),"httpl"==e.urld.protocol?d(e):v(e)},local.http.setEventSubscriber=function(e){_=e},local.http.EventStream=g,g.prototype=Object.create(local.util.EventEmitter.prototype),g.prototype.close=function(){this.isConnOpen=!1,this.emit("close"),this.removeAllListeners()},g.prototype.__emitError=function(e){this.emit("message",e),this.emit("error",e)},g.prototype.__emitEvent=function(e){this.emit("message",e),this.emit(e.event,e)},local.http.LocalEventStream=w,w.prototype=Object.create(g.prototype),w.prototype.close=function(){this.__emitError({event:"error",data:void 0}),g.prototype.close.call(this),this.response&&this.response.close(),this.response=null},local.http.BrowserRemoteEventStream=x,x.prototype=Object.create(g.prototype),x.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if(!this._events[e]){var r=this;this.eventSource.addEventListener(e,function(e){var t=e.data;try{t=JSON.parse(t)}catch(n){}r.__emitEvent({event:e.type,data:t})})}local.util.EventEmitter.prototype.addListener.call(this,e,t)},x.prototype.on=x.prototype.addListener,x.prototype.close=function(){this.eventSource.close(),this.eventSource.onerror=null,this.eventSource=null,g.prototype.close.call(this)},local.http.Broadcaster=b,b.prototype.addStream=function(e){this.streams.push(e);var t=this;e.clientResponse.on("close",function(){t.endStream(e)})},b.prototype.endStream=function(e){this.streams=this.streams.filter(function(t){return t!=e}),e.end()},b.prototype.endAllStreams=function(){this.streams.forEach(function(e){e.end()}),this.streams.length=0},b.prototype.emit=function(e,t){this.streams.forEach(function(r){this.emitTo(r,e,t)},this)},b.prototype.emitTo=function(e,t,r){e.write({event:t,data:r})},local.http.broadcaster=function(){return new b},function(e){"use strict";function t(e){var r;if(null===e||void 0===e)return!1;if(n.isArray(e))return e.length>0;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(r in e)if(e.hasOwnProperty(r)&&t(e[r]))return!0;return!1}var r=function(){function e(e){this.options=e}return e.prototype.toString=function(){return JSON&&JSON.stringify?JSON.stringify(this.options):this.options},e}(),n=function(){function e(e){return"[object Array]"===Object.prototype.toString.apply(e)}function t(e){return"[object String]"===Object.prototype.toString.apply(e)}function r(e){return"[object Number]"===Object.prototype.toString.apply(e)}function n(e){return"[object Boolean]"===Object.prototype.toString.apply(e)}function o(e,t){var r,n="",o=!0;for(r=0;r<e.length;r+=1)o?o=!1:n+=t,n+=e[r];return n}function i(e,t){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}function s(e,t){for(var r=[],n=0;n<e.length;n+=1)t(e[n])&&r.push(e[n]);return r}function a(e){if("object"!=typeof e||null===e)return e;Object.freeze(e);var t,r;for(r in e)e.hasOwnProperty(r)&&(t=e[r],"object"==typeof t&&l(t));return e}function l(e){return"function"==typeof Object.freeze?a(e):e}return{isArray:e,isString:t,isNumber:r,isBoolean:n,join:o,map:i,filter:s,deepFreeze:l}}(),o=function(){function e(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e}function t(e){return e>="0"&&"9">=e}function r(e){return t(e)||e>="a"&&"f">=e||e>="A"&&"F">=e}return{isAlpha:e,isDigit:t,isHexDigit:r}}(),i=function(){function e(e){return e.length>1?e:"0"+e}function t(t){var r,n,o="",i=a.encode(t);for(n=0;n<i.length;n+=1)r=i.charCodeAt(n),o+="%"+e(r.toString(16).toUpperCase());return o}function r(e,t){return"%"===e.charAt(t)&&o.isHexDigit(e.charAt(t+1))&&o.isHexDigit(e.charAt(t+2))}function n(e,t){return parseInt(e.substr(t,2),16)}function i(e){if(!r(e,0))return!1;var t=n(e,1),o=a.numBytes(t);if(0===o)return!1;for(var i=1;o>i;i+=1)if(!r(e,3*i)||!a.isValidFollowingCharCode(n(e,3*i+1)))return!1;return!0}function s(e,t){var o=e.charAt(t);if(!r(e,t))return o;var i=n(e,t+1),s=a.numBytes(i);if(0===s)return o;for(var l=1;s>l;l+=1)if(!r(e,t+3*l)||!a.isValidFollowingCharCode(n(e,t+3*l+1)))return o;return e.substr(t,3*s)}var a={encode:function(e){return unescape(encodeURIComponent(e))},numBytes:function(e){return 127>=e?1:e>=194&&223>=e?2:e>=224&&239>=e?3:e>=240&&244>=e?4:0},isValidFollowingCharCode:function(e){return e>=128&&191>=e}};return{encodeCharacter:t,isPctEncoded:i,pctCharAt:s}}(),s=function(){function e(e){return o.isAlpha(e)||o.isDigit(e)||"_"===e||i.isPctEncoded(e)}function t(e){return o.isAlpha(e)||o.isDigit(e)||"-"===e||"."===e||"_"===e||"~"===e}function r(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}return{isVarchar:e,isUnreserved:t,isReserved:r}}(),a=function(){function e(e,t){var r,n="",o="";for(("number"==typeof e||"boolean"==typeof e)&&(e=e.toString()),r=0;r<e.length;r+=o.length)o=e.charAt(r),n+=s.isUnreserved(o)||t&&s.isReserved(o)?o:i.encodeCharacter(o);return n}function t(t){return e(t,!0)}function r(e,t){var r=i.pctCharAt(e,t);return r.length>1?r:s.isReserved(r)||s.isUnreserved(r)?r:i.encodeCharacter(r)}function n(e){var t,r="",n="";for(t=0;t<e.length;t+=n.length)n=i.pctCharAt(e,t),r+=n.length>1?n:s.isReserved(n)||s.isUnreserved(n)?n:i.encodeCharacter(n);return r}return{encode:e,encodePassReserved:t,encodeLiteral:n,encodeLiteralCharacter:r}}(),l=function(){function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?a.encodePassReserved:a.encode,toString:function(){return this.symbol}}}var t={};return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){return t[e]?t[e]:"=,!@|".indexOf(e)>=0?null:t[""]}}}(),u=function(){function e(e){this.literal=a.encodeLiteral(e)}return e.prototype.expand=function(){return this.literal},e.prototype.toString=e.prototype.expand,e}(),c=function(){function e(e){function t(){var t=e.substring(f,u);if(0===t.length)throw new r({expressionText:e,message:"a varname must be specified",position:u});h={varname:t,exploded:!1,maxLength:null},f=null}function n(){if(d===u)throw new r({expressionText:e,message:"after a ':' you have to specify the length",position:u});h.maxLength=parseInt(e.substring(d,u),10),d=null}var a,u,c=[],h=null,f=null,d=null,v="";for(a=function(t){var n=l.valueOf(t);if(null===n)throw new r({expressionText:e,message:"illegal use of reserved operator",position:u,operator:t});return n}(e.charAt(0)),u=a.symbol.length,f=u;u<e.length;u+=v.length){if(v=i.pctCharAt(e,u),null!==f){if("."===v){if(f===u)throw new r({expressionText:e,message:"a varname MUST NOT start with a dot",position:u});continue}if(s.isVarchar(v))continue;t()}if(null!==d){if(u===d&&"0"===v)throw new r({expressionText:e,message:"A :prefix must not start with digit 0",position:u});if(o.isDigit(v)){if(u-d>=4)throw new r({expressionText:e,message:"A :prefix must have max 4 digits",position:u});continue}n()}if(":"!==v)if("*"!==v){if(","!==v)throw new r({expressionText:e,message:"illegal character",character:v,position:u});c.push(h),h=null,f=u+1}else{if(null===h)throw new r({expressionText:e,message:"exploded without varspec",position:u});if(h.exploded)throw new r({expressionText:e,message:"exploded twice",position:u});if(h.maxLength)throw new r({expressionText:e,message:"an explode (*) MUST NOT follow to a prefix",position:u});h.exploded=!0}else{if(null!==h.maxLength)throw new r({expressionText:e,message:"only one :maxLength is allowed per varspec",position:u});if(h.exploded)throw new r({expressionText:e,message:"an exploeded varspec MUST NOT be varspeced",position:u});d=u+1}}return null!==f&&t(),null!==d&&n(),c.push(h),new p(e,a,c)}function t(t){var n,o,i=[],s=null,a=0;for(n=0;n<t.length;n+=1)if(o=t.charAt(n),null===a){if(null===s)throw new Error("reached unreachable code");if("{"===o)throw new r({templateText:t,message:"brace already opened",position:n});if("}"===o){if(s+1===n)throw new r({templateText:t,message:"empty braces",position:s});try{i.push(e(t.substring(s+1,n)))}catch(l){if(l.prototype===r.prototype)throw new r({templateText:t,message:l.options.message,position:s+l.options.position,details:l.options});throw l}s=null,a=n+1}}else{if("}"===o)throw new r({templateText:t,message:"unopened brace closed",position:n});"{"===o&&(n>a&&i.push(new u(t.substring(a,n))),a=null,s=n)}if(null!==s)throw new r({templateText:t,message:"unclosed brace",position:s});return a<t.length&&i.push(new u(t.substr(a))),new h(t,i)}return t}(),p=function(){function e(e){return JSON&&JSON.stringify?JSON.stringify(e):e}function r(e){if(!t(e))return!0;if(n.isString(e))return""===e;if(n.isNumber(e)||n.isBoolean(e))return!1;if(n.isArray(e))return 0===e.length;for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}function o(e){var t,r=[];for(t in e)e.hasOwnProperty(t)&&r.push({name:t,value:e[t]});return r}function i(e,t,r){this.templateText=e,this.operator=t,this.varspecs=r}function s(e,t,r){var n="";if(r=r.toString(),t.named){if(n+=a.encodeLiteral(e.varname),""===r)return n+=t.ifEmpty;n+="="}return null!==e.maxLength&&(r=r.substr(0,e.maxLength)),n+=t.encode(r)}function l(e){return t(e.value)}function u(e,i,s){var u=[],c="";if(i.named){if(c+=a.encodeLiteral(e.varname),r(s))return c+=i.ifEmpty;c+="="}return n.isArray(s)?(u=s,u=n.filter(u,t),u=n.map(u,i.encode),c+=n.join(u,",")):(u=o(s),u=n.filter(u,l),u=n.map(u,function(e){return i.encode(e.name)+","+i.encode(e.value)}),c+=n.join(u,",")),c}function c(e,i,s){var u=n.isArray(s),c=[];return u?(c=s,c=n.filter(c,t),c=n.map(c,function(t){var n=a.encodeLiteral(e.varname);return n+=r(t)?i.ifEmpty:"="+i.encode(t)})):(c=o(s),c=n.filter(c,l),c=n.map(c,function(e){var t=a.encodeLiteral(e.name);return t+=r(e.value)?i.ifEmpty:"="+i.encode(e.value)})),n.join(c,i.separator)}function p(e,r){var i=[],s="";return n.isArray(r)?(i=r,i=n.filter(i,t),i=n.map(i,e.encode),s+=n.join(i,e.separator)):(i=o(r),i=n.filter(i,function(e){return t(e.value)}),i=n.map(i,function(t){return e.encode(t.name)+"="+e.encode(t.value)}),s+=n.join(i,e.separator)),s}return i.prototype.toString=function(){return this.templateText},i.prototype.expand=function(o){var i,a,l,h,f=[],d=!1,v=this.operator;for(i=0;i<this.varspecs.length;i+=1)if(a=this.varspecs[i],l=o[a.varname],null!==l&&void 0!==l)if(a.exploded&&(d=!0),h=n.isArray(l),"string"==typeof l||"number"==typeof l||"boolean"==typeof l)f.push(s(a,v,l));else{if(a.maxLength&&t(l))throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+e(l));a.exploded?t(l)&&(v.named?f.push(c(a,v,l)):f.push(p(v,l))):(v.named||!r(l))&&f.push(u(a,v,l))}return 0===f.length?"":v.first+n.join(f,v.separator)},i}(),h=function(){function e(e,t){this.templateText=e,this.expressions=t,n.deepFreeze(this)}return e.prototype.toString=function(){return this.templateText},e.prototype.expand=function(e){var t,r="";for(t=0;t<this.expressions.length;t+=1)r+=this.expressions[t].expand(e);return r},e.parse=c,e.UriTemplateError=r,e}();e(h)}(function(e){"use strict";local.http.UriTemplate=e});var T=["head","post","put","patch","delete"],O={Json:"application/json",Html:"text/html",Xml:"text/xml",Events:"text/event-stream",Eventstream:"text/event-stream",Plain:"text/plain",Text:"text/plain"},N=["alternate","author","collection","current","describedby","first","index","item","last","latest-version","monitor","monitor-group","next","next-archive","payment","predecessor-version","prev","prev-archive","related","replies","search","self","service","successor-version","up","version-history","via","working-copy","working-copy-of"];k.UNRESOLVED=0,k.RESOLVED=1,k.FAILED=2,k.prototype.isResolved=function(){return this.resolveState===k.RESOLVED},k.prototype.isBad=function(){return this.resolveState>1},k.prototype.isRelative=function(){return!this.url&&!!this.rel},k.prototype.isAbsolute=function(){return!!this.url},k.prototype.getUrl=function(){return this.url},k.prototype.getError=function(){return this.error},k.prototype.getHost=function(){if(!this.host){if(!this.url)return null;var e=local.http.parseUri(this.url);this.host=(e.protocol||"http")+"://"+(e.authority||L())}return this.host},k.prototype.resetResolvedState=function(){this.resolveState=k.UNRESOLVED,this.error=null},k.prototype.resolve=function(e){this.error=null,this.resolveState=k.RESOLVED,this.url=e;var t=local.http.parseUri(this.url);this.host=(t.protocol||"http")+"://"+t.authority},local.http.Navigator=E,E.prototype.dispatch=function(e){if(!e||!e.method)throw"request options not provided";var t=this,r=local.promise();return(e.noresolve?local.promise(this.context.getUrl()):this.resolve({retry:e.retry,nohead:!0})).succeed(function(t){return e.url=t,local.http.dispatch(e)}).succeed(function(e){return t.context.error=null,t.context.resolveState=k.RESOLVED,t.links=e.headers.link?e.headers.link:t.links||[],e}).fail(function(e){throw 404===e.status&&(t.context.error=e,t.context.resolveState=k.FAILED),e}).chain(r),r},E.prototype.subscribe=function(){return this.resolve().succeed(function(e){return local.http.subscribe(e)})},E.prototype.relation=function(e,t,r){var n=r||{};return n.title=(t||"").toLowerCase(),new E(new k(e,n),this)},E.prototype.resolve=function(e){var t=this;e=e||{};var r=e.nohead;delete e.nohead;var n=local.promise();return null!==this.links&&(this.context.isResolved()||this.context.isAbsolute()&&this.context.isBad()===!1)?n.fulfill(this.context.getUrl()):this.context.isBad()===!1||this.context.isBad()&&e.retry?(this.context.resetResolvedState(),this.parentNavigator?this.parentNavigator.__resolveChild(this,e).succeed(function(){return r?!0:t.head(null,null,null,{noresolve:!0})}).succeed(function(){return t.context.getUrl()}).chain(n):(r?local.promise(!0):this.head(null,null,null,{noresolve:!0})).succeed(function(){return t.context.getUrl()}).chain(n)):n.reject(this.context.getError()),n},E.prototype.__resolveChild=function(e,t){var r=this,n=local.promise();return this.resolve(t).then(function(){var t=r.__lookupLink(e.context);if(t)e.context.resolve(t),n.fulfill(t);else{var o=new local.http.ClientResponse(404,"link relation not found");n.reject(o),o.end()}},function(t){return e.context.error=t,e.context.resolveState=k.FAILED,n.reject(t),t}),n},E.prototype.__lookupLink=function(e){var t=local.http.lookupLink(this.links,e.rel,e.relparams.title);if(t){var r=local.http.UriTemplate.parse(t).expand(e.relparams),n=local.http.parseUri(r);return n.host||(r=this.context.getHost()+n.relative),r
}return console.log("Failed to find a link to resolve context. Target link:",e.rel,e.relparams,"Navigator:",this),null},T.forEach(function(e){E.prototype[e]=function(t,r,n,o){var i=o||{};return i.headers=n||{},i.method=e,null!==t&&"null"!=typeof t&&/head/i.test(e)===!1&&(i.headers["content-type"]=r||("object"==typeof t?"application/json":"text/plain")),i.body=t,this.dispatch(i)}}),E.prototype.get=function(e,t,r){var n=r||{};return n.headers=t||{},n.method="get",n.headers.accept=e,this.dispatch(n)};for(var U in O)!function(e,t){E.prototype["get"+e]=function(e,r){return this.get(t,e,r)}}(U,O[U]);N.forEach(function(e){var t=e.replace(/-/g,"_");E.prototype[t]=function(t,r){return this.relation(e,t,r)}}),local.http.navigator=function(e,t,r){if(e instanceof E)return e;var n;return n=Array.isArray(e)?local.http.lookupLink(e,t,r):e,new E(n)}}(),"undefined"==typeof this.local&&(this.local={}),"undefined"==typeof this.local.worker&&(this.local.worker={}),function(){function e(t){return Array.isArray(t)?t.map(e):t&&"object"==typeof t?JSON.stringify(t):t}function t(e,t){var r=255&e.charCodeAt(t);return r}function r(e,t){return t="(function(){ var module = { exports:{} }; "+t+'; self.modules["'+e+'"] = module.exports; })();',"data:text/javascript;base64,"+btoa(t)}!function(){function e(){return n++}function t(t,r,n){var o={id:e(),reply_to:n,name:t,data:r};return o}function r(e,t,r){t&&"function"==typeof t&&(o[e.id]={func:t,context:r}),self.postMessage(e)}var n=1,o={},i={};self.addEventListener("message",function(e){var t=e.data;if("reply"===t.name){var r=o[t.reply_to];if(r)return r.func.call(r.context,t),delete o[t.reply_to],void 0}var n=i[t.name];if("endMessage"===t.name){var s=t.data;n=i[s],local.worker.removeAllNamedMessageListeners(s)}n&&n.forEach(function(e){e.func.call(e.context,t)})}),local.worker.postNamedMessage=function(e,n,o,i){var s=t(e,n);return r(s,o,i),s.id},local.worker.postReply=function(e,n,o,i){var s="object"==typeof e?e.id:e,a=t("reply",n,s);return r(a,o,i),a.id},local.worker.endMessage=function(e){return local.worker.postNamedMessage("endMessage",e)},local.worker.addNamedMessageListener=function(e,t,r){e in i||(i[e]=[]),i[e].push({func:t,context:r})},local.worker.onNamedMessage=local.worker.addNamedMessageListener,local.worker.removeNamedMessageListener=function(e,t){if(e in i){var r=function(e){return e.func!=t};i[e]=i[e].filter(r),0===i[e].length&&delete i[e]}},local.worker.removeAllNamedMessageListeners=function(e){e in i&&delete i[e]}}(),local.http.setRequestDispatcher(function(e){if("function"==typeof e)return local.worker.logStack();var t=local.promise();return local.worker.postNamedMessage("httpRequest",e,function(r){if(!r.data)throw"Invalid httpRequest reply to worker from document";var n=new local.http.ClientResponse(r.data.status,r.data.reason);n.headers=r.data.headers,!e.stream&&r.data.body&&n.write(r.data.body),n.status>=200&&n.status<300?t.fulfill(n):n.status>=400||!n.status?t.reject(n):t.fulfill(n),e.stream&&r.data.body&&n.write(r.data.body),local.worker.onNamedMessage(r.id,function(e){"endMessage"===e.name?n.end():n.write(e.data)})}),t}),local.http.setEventSubscriber(function(e){var t=new local.http.EventStream,r=local.worker.postNamedMessage("httpSubscribe",e);return t.addListener=t.on=function(e,t){local.worker.postNamedMessage(r,e,function(e){local.worker.onNamedMessage(e.id,function(e){t(e.data)})})},t.on("close",function(){local.worker.endMessage(r)}),t}),local.worker.onNamedMessage("httpRequest",function(e){var t=e.data;if(main){var r=function(t){var r=local.worker.postReply(e,t);t.isConnOpen?(t.on("data",function(e){local.worker.postNamedMessage(r,e)}),t.on("end",function(){local.worker.endMessage(r),local.worker.removeAllNamedMessageListeners(e.id)})):(local.worker.endMessage(r),local.worker.removeAllNamedMessageListeners(e.id))},n=local.promise();n.then(r,r);var o=new local.http.ServerResponse(n,t.stream);local.worker.onNamedMessage(e.id,function(e){"endMessage"==e.name&&o.clientResponse.close()}),main(t,o)}else{var i=local.worker.postReply(e,{status:404,reason:"server not loaded"});local.worker.endMessage(i)}});var n=importScripts,o=XMLHttpRequest;if(local.worker.log=function(){var t=Array.prototype.slice.call(arguments);1==t.length&&(t=t[0]);try{local.worker.postNamedMessage("log",t)}catch(r){local.worker.postNamedMessage("log",e(t))}},self.console={},self.console.log=local.worker.log,local.worker.logStack=function(){try{stack_trace._fake+=0}catch(e){console.log(e.stack)}},!self.btoa){var i="=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";self.btoa=function(e){var r,n,o=i,a=s,l=[];e=""+e;var u=e.length-e.length%3;if(0===e.length)return e;for(r=0;u>r;r+=3)n=t(e,r)<<16|t(e,r+1)<<8|t(e,r+2),l.push(a.charAt(n>>18)),l.push(a.charAt(63&n>>12)),l.push(a.charAt(63&n>>6)),l.push(a.charAt(63&n));switch(e.length-u){case 1:n=t(e,r)<<16,l.push(a.charAt(n>>18)+a.charAt(63&n>>12)+o+o);break;case 2:n=t(e,r)<<16|t(e,r+1)<<8,l.push(a.charAt(n>>18)+a.charAt(63&n>>12)+a.charAt(63&n>>6)+o)}return l.join("")}}self.require=function(e){if(local.worker.config&&-1===e.indexOf("://")&&"/"!=e.charAt(0)&&(e=local.worker.config.srcBaseUrl+e),e in self.modules)return self.modules[e];var t=new o;return t.open("GET",e,!1),t.send(null),t.status>=200&&t.status<300?/\.js$/.test(e)?(n(r(e,t.responseText)),self.modules[e]):(self.modules[e]=t.responseText,t.responseText):(console.log("Failed to require("+e+") - "+t.status),null)},self.modules={},local.worker.onNamedMessage("nullify",function(e){if(console.log("nullifying: "+e.data),!e||"string"!=typeof e.data)throw"'nullify' message must include a valid string";self[e.data]=null}),local.worker.onNamedMessage("importScripts",function(e){if(console.log("importingScripts: "+e.data),!e||!e.data)throw"'importScripts' message must include a valid array/string";try{n(e.data)}catch(t){throw local.worker.postReply(e,{error:!0,reason:t?t.toString():t}),t}local.worker.postReply(e,{error:!1})}),local.worker.postNamedMessage("ready",null,function(e){local.worker.config=e.data})}();