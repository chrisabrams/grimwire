function noop(){}"undefined"==typeof local?function(){function e(){return r++}function t(t,n,r){var o={id:e(),reply_to:r,name:t,data:n};return o}function n(e,t,n){t&&"function"==typeof t&&(local.replyCbs[e.id]={func:t,context:n}),self.postMessage(e)}var r=1;self.local={replyCbs:{},messageListeners:{}},self.addEventListener("message",function(e){var t=e.data;if(t.name==="reply"){var n=local.replyCbs[t.reply_to];if(n)return n.func.call(n.context,t),delete local.replyCbs[t.reply_to],void 0}var r=local.messageListeners[t.name];if(t.name==="endMessage"){var o=t.data;r=local.messageListeners[o],local.removeAllMessageListeners(o)}r&&r.forEach(function(e){e.func.call(e.context,t)})}),local.postMessage=function(e,r,o,i){var s=t(e,r);return n(s,o,i),s.id},local.postReply=function(e,r,o,i){var s="object"==typeof e?e.id:e,a=t("reply",r,s);return n(a,o,i),a.id},local.endMessage=function(e){return this.postMessage("endMessage",e)},local.addMessageListener=function(e,t,n){e in local.messageListeners||(local.messageListeners[e]=[]),local.messageListeners[e].push({func:t,context:n})},local.onMessage=local.addMessageListener,local.removeMessageListener=function(e,t){if(e in local.messageListeners){var n=function(e){return e.func!=t};local.messageListeners[e]=local.messageListeners[e].filter(n),local.messageListeners[e].length===0&&delete local.messageListeners[e]}},local.removeAllMessageListeners=function(e){e in local.messageListeners&&delete local.messageListeners[e]},local.log=function(){var e=Array.prototype.slice.call(arguments);e.length>1?local.postMessage("log",e):local.postMessage("log",e[0])},local.logStack=function(){try{stack_trace._fake+=0}catch(e){local.log(e.stack)}},local.onMessage("nullify",function(e){if(local.log("nullifying: "+e.data),!e||typeof e.data!="string")throw"'nullify' message must include a valid string";self[e.data]=null}),local.onMessage("importScripts",function(e){if(local.log("importingScripts: "+e.data),!e||!e.data)throw"'importScripts' message must include a valid array/string";try{self.importScripts(e.data)}catch(t){throw local.postReply(e,{error:!0,reason:t.toString()}),t}local.postReply(e,{error:!1})}),local.postMessage("ready",null,function(e){local.config=e.data})}():null;var console={};console.log=local.log,function(){function e(e){return e}function t(e){this.fulfillCBs=[],this.exceptCBs=[],this.value=void 0,e&&(e instanceof Error?this.reject(e):this.fulfill(e))}function n(e,t,n){var r=t.apply(e,[this.value].concat(n));"undefined"!=typeof r&&(r instanceof Error?e.reject(r):e.fulfill(r))}function r(e){if(arguments.length>1){var n=r(),o=arguments.length,i=0,s=[];s.length=o;for(var a=function(e,t){s[t]=e,++i==o&&n.fulfill(s)},l=0;o>l;l++)r(arguments[l]).then(a,l).except(a,l);return n}return e instanceof t?e:new t(e)}var o=this;"undefined"!=typeof window?o=window:"undefined"!=typeof self?o=self:"undefined"!=typeof module&&(o=module.exports),t.prototype.isUnfulfilled=function(){return typeof this.value=="undefined"},t.prototype.isRejected=function(){return this.value instanceof Error},t.prototype.isFulfilled=function(){return!this.isUnfulfilled()&&!this.isRejected()},t.prototype.then=function(t){if(this.isRejected())return this;var o=r(),i=Array.prototype.slice.call(arguments,1);return this.isUnfulfilled()?(this.fulfillCBs.push({p:o,fn:t,args:i}),this.exceptCBs.push({p:o,fn:e,args:[]})):n.call(this,o,t,i),o},t.prototype.except=function(t){if(this.isFulfilled())return this;var o=r(),i=Array.prototype.slice.call(arguments,1);return this.isUnfulfilled()?(this.exceptCBs.push({p:o,fn:t,args:i}),this.fulfillCBs.push({p:o,fn:e,args:[]})):n.call(this,o,t,i),o},t.prototype.fulfill=function(e){if(this.isUnfulfilled()){this.value=e;for(var t=0;t<this.fulfillCBs.length;t++){var r=this.fulfillCBs[t];n.call(this,r.p,r.fn,r.args)}this.fulfillCBs.length=0,this.exceptCBs.length=0}return this},t.prototype.reject=function(e){if(this.isUnfulfilled()){e instanceof Error||(e=new Error(e)),this.value=e;for(var t=0;t<this.exceptCBs.length;t++){var r=this.exceptCBs[t];n.call(this,r.p,r.fn,r.args)}this.fulfillCBs.length=0,this.exceptCBs.length=0}return this},t.prototype.fulfillOrReject=function(e,t){return e?this.reject(e):this.fulfill("undefined"==typeof t?null:t)},t.prototype.cancel=function(){var e;for(e=0;e<this.fulfillCBs.length;e++)this.fulfillCBs[e].p.cancel();for(e=0;e<this.exceptCBs.length;e++)this.exceptCBs[e].p.cancel();return this.fulfillCBs.length=0,this.exceptCBs.length=0,this},t.prototype.chain=function(e){return this.then(function(t){return r(e).fulfill(t),t}),this.except(function(t){return r(e).reject(t),t}),e},o.Promise=t,o.promise=r}(),"undefined"!=typeof define&&define([],function(){return Promise});var Link={};(function(e){function t(){this._events={}}function n(e){if(e&&"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function r(e){return e instanceof n?e:new n(e)}function o(e,t){if(!e||"object"!=typeof e||!t)return e;var n=l(t,"serializer");return n?n(e):e}function i(e,t){if(!e||"string"!=typeof e||!t)return e;var n=l(t,"deserializer");return n?n(e):e}function s(e,t,n){c[e]={serializer:t,deserializer:n}}function a(e){var t=e.split(";"),n=t[0];if(t=n.split("/"),t[1]){var r=t[1].split("+");return r[1]?[n,t[0]+"/"+r[1],t[0]]:[n,t[0]]}return[n]}function l(e,t){for(var n=a(e),r=0;r<n.length;r++)if(n[r]in c)return c[n[r]][t];return null}t.prototype.emit=function(e){var t=this._events[e];if(!t)return!1;for(var n=Array.prototype.slice.call(arguments,1),r=0,o=t.length;o>r;r++)t[r].apply(this,n);return!0},t.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if("function"!=typeof t)throw new Error("addListener only takes instances of Function");return this.emit("newListener",e,t),this._events[e]?this._events[e].push(t):this._events[e]=[t],this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var n=this;n.on(e,function r(){n.removeListener(e,r),t.apply(this,arguments)})},t.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events[e])return this;var n=this._events[e],r=n.indexOf(t);return 0>r?this:(n.splice(r,1),n.length===0&&delete this._events[e],this)},t.prototype.removeAllListeners=function(e){return e&&this._events[e]&&(this._events[e]=null),this},t.prototype.listeners=function(e){return this._events[e]},e.EventEmitter=t,n.prototype.addLink=function(e,t,n){var r=n||{};return r.href=e,r.rel=t,this.link||(this.link=[]),this.link.push(r),this},n.prototype.setAuth=function(e){return this.authorization=e,this},n.prototype.serialize=function(){if(this.link&&Array.isArray(this.link))throw"Link header serialization is not yet implemented";if(this.authorization&&typeof this.authorization=="object"){if(!this.authorization.scheme)throw"`scheme` required for auth headers";var e;switch(this.authorization.scheme.toLowerCase()){case"basic":e="Basic "+btoa(this.authorization.name+":"+this.authorization.password);break;case"persona":e="Persona name="+this.authorization.name+" assertion="+this.authorization.assertion;break;default:throw"unknown auth sceme: "+this.authorization.scheme}this.authorization=e}return this},e.Headerer=n,e.headerer=r,e.parseLinkHeader=function(e){return"string"!=typeof e?e:e.replace(/,[\s]*</g,"|||<").split("|||").map(function(e){var t={};return e.trim().split(";").forEach(function(e){if(e=e.trim())if(e.charAt(0)==="<")t.href=e.trim().slice(1,-1);else{var n=e.split("="),r=n[0].trim(),o=n[1].trim().slice(1,-1);t[r]=o}}),t})},e.lookupLink=function(e,t,n){var r=e?e.length:0;if(!r)return null;n=n.toLowerCase();for(var o=null,i=0;r>i;i++){var s=e[i];if(s&&s.rel&&s.rel.indexOf(t)!==-1)if(s.title){if(s.title.toLowerCase()===n){o=s;break}}else o=s}return o?o.href:null},e.joinUrl=function(){var e=Array.prototype.map.call(arguments,function(e){var t=0,n=e.length;return e.charAt(0)==="/"&&(t+=1),e.charAt(n-1)==="/"&&(n-=1),e.substring(t,n)});return e.join("/")},e.parseUri=function(t){"object"==typeof t&&(t.url?t=t.url:(t.host||t.path)&&(t=Link.joinUrl(req.host,req.path)));for(var n=e.parseUri.options,r=n.parser[n.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[n.key[i]]=r[i]||"";return o[n.q.name]={},o[n.key[12]].replace(n.q.parser,function(e,t,r){t&&(o[n.q.name][t]=r)}),o},e.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var u={serialize:o,deserialize:i,register:s},c={};s("application/json",function(e){try{return JSON.stringify(e)}catch(t){return t.message}},function(e){try{return JSON.parse(e)}catch(t){return t.message}}),s("application/x-www-form-urlencoded",function(e){var t=encodeURIComponent,n=[];for(var r in e)if(e[r]===null)n.push(r+"=");else if(Array.isArray(e[r]))for(var o=0;o<e[r].length;o++)n.push(r+"[]="+t(e[r][o]));else if(typeof e[r]=="object")for(var i in e[r])n.push(r+"["+i+"]="+t(e[r][i]));else n.push(r+"="+t(e[r]));return n.join("&")},function(e){for(var t=e.split("&"),n={},r=0;r<t.length;r++){var o=t[r].split("="),i=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),a=/\[\]$/.test(i),l=i.match(/^(.+)\[([^\]]+)\]$/);if(l){i=l[1];var u=l[2];n[i]=n[i]||{},n[i][u]=s}else a?(i=i.substring(0,i.length-2),n[i]=n[i]||[],n[i].push(s)):n[i]=s}return n}),e.contentTypes=u})(Link),function(e){function t(e){e=e||{},e.headers=e.readers||{},this.message=""+e.status+": "+e.reason,this.response=e}function n(e){if(!e)throw"no req param provided to request";if(e.headers=e.headers||{},e.query=e.query||{},y)return y(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided in request";e.urld.protocol||(e.url=e.url.length>0&&e.url.charAt(0)!="/"?window.location.protocol+"//"+window.location.host+v+e.url:window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url));var n=promise();return e.urld.protocol=="httpl"?setTimeout(function(){r(e,n)},0):e.urld.protocol=="http"||e.urld.protocol=="https"?setTimeout(function(){o(e,n)},0):n.fulfill(new t({status:0,reason:'unsupported protocol "'+e.urld.protocol+'"'})),n}function r(e,n){var r=d[e.urld.host];if(!r){var o=new l(404,"server not found");return n.reject(new t(o)),o.end(),void 0}var i={path:e.urld.path,method:e.method,query:e.query||{},headers:e.headers||{},body:e.body,stream:e.stream};if(e.urld.query){var s=Link.contentTypes.deserialize(e.urld.query,"application/x-www-form-urlencoded");for(var a in s)i.query[a]=s[a]}r.fn.call(r.context,i,new u(n,e.stream))}function o(e,t){if(e.query){var n=Link.contentTypes.serialize(e.query,"application/x-www-form-urlencoded");n&&(e.urld.query?(e.urld.query+="&"+n,e.urld.relative+="&"+n):(e.urld.query=n,e.urld.relative+="?"+n))}"undefined"!=typeof window?i(e,t):s(e,t)}function i(e,n){var r=(e.urld.protocol?e.urld.protocol+"://":"")+e.urld.authority+e.urld.relative;e.headers=Link.headerer(e.headers).serialize(),e.body!==null&&typeof e.body!="undefined"&&(e.headers["content-type"]=e.headers["content-type"]||"application/json",typeof e.body!="string"&&(e.body=Link.contentTypes.serialize(e.body,e.headers["content-type"])));var o=new XMLHttpRequest;o.open(e.method,r,!0);for(var i in e.headers)e.headers[i]!==null&&e.headers.hasOwnProperty(i)&&o.setRequestHeader(i,e.headers[i]);var s,a=0,u=0;o.onreadystatechange=function(){if(o.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!s&&(s=new l(o.status,o.statusText),o.getAllResponseHeaders().split("\n").forEach(function(e){if(e){var t=e.toLowerCase().replace("\r","").split(": ");s.headers[t[0]]=t[1]}}),s.headers.link&&(s.headers.link=Link.parseLinkHeader(s.headers.link)),e.stream&&(s.status>=200&&s.status<400?n.fulfill(s):s.status>=400&&s.status<600?n.reject(new t(s)):s.status===0?n.reject(new t({code:0,reason:"Remote connection refused by the host"})):n.reject(new t(s)),a=setInterval(function(){var e=o.responseText.length;e>u&&(u=e,s.write(o.responseText,!0))},e.streamPoll||500))),o.readyState===XMLHttpRequest.DONE){s=s||new l(o.status,o.statusText),a&&clearInterval(a);var r=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]);e.stream?s.write(r):(s.body=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]),s.status>=200&&s.status<400?n.fulfill(s):s.status>=400&&s.status<600?n.reject(new t(s)):s.status===0?n.reject(new t({code:0,reason:"Remote connection refused by the host"})):n.reject(new t(s))),s.end()}},o.send(e.body)}function s(e,t){var n=new l(0,"dispatch() has not yet been implemented for nodejs");t.reject(n),n.end()}function a(e){y=e}function l(e,t){Link.EventEmitter.call(this),this.status=e,this.reason=t,this.headers={},this.body=null,this.isConnOpen=!0}function u(e,t){Link.EventEmitter.call(this),this.resPromise=e,this.isStreaming=t,this.clientResponse=new l}function c(e,t,n){var r=Link.parseUri(e);if(r.protocol&&r.protocol!=="httpl")throw"registerLocal can only add servers to the httpl protocol";if(!r.host)throw"invalid domain provided to registerLocal";if(d[r.host])throw"server already registered at domain given to registerLocal";d[r.host]={fn:t,context:n}}function p(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";d[t.host]&&delete d[t.host]}function h(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";return d[t.host]}function f(){return d}var d={},y=null,v="undefined"!=typeof window?window.location.pathname.split("/"):[""];v[v.length-1]="",v=v.join("/"),t.prototype=new Error,l.prototype=Object.create(Link.EventEmitter.prototype),l.prototype.write=function(e,t){if(t||"string"!=typeof e||typeof this.body!="string"){var n=this.body&&typeof this.body=="string"?this.body.length:0;this.body=e,e="string"==typeof e?e.slice(n):e}else this.body+=e;this.emit("data",e)},l.prototype.end=function(){this.__deserialize(),this.isConnOpen=!1,this.emit("end")},l.prototype.__deserialize=function(){typeof this.body=="string"&&(this.body=Link.contentTypes.deserialize(this.body,this.headers["content-type"]))},u.prototype=Object.create(Link.EventEmitter.prototype),u.prototype.writeHead=function(e,t,n){this.clientResponse.status=e,this.clientResponse.reason=t;for(var r in n)n.hasOwnProperty(r)&&this.setHeader(r,n[r]);this.isStreaming&&this.__fulfillPromise()},u.prototype.setHeader=function(e,t){this.clientResponse.headers[e]=t},u.prototype.getHeader=function(e){return this.clientResponse.headers[e]},u.prototype.removeHeader=function(e){delete this.clientResponse.headers[e]},u.prototype.write=function(e){this.clientResponse.write(e,!1)},u.prototype.end=function(e){e&&this.write(e),this.isStreaming||(this.clientResponse.__deserialize(),this.__fulfillPromise()),this.clientResponse.end(),this.emit("close"),this.removeAllListeners("close"),this.clientResponse.removeAllListeners("data"),this.clientResponse.removeAllListeners("end")},u.prototype.__fulfillPromise=function(){this.clientResponse.status>=200&&this.clientResponse.status<400?this.resPromise.fulfill(this.clientResponse):this.clientResponse.status>=400&&this.clientResponse.status<600?this.resPromise.reject(new t(this.clientResponse)):this.resPromise.reject(new t(this.clientResponse))},u.prototype.writeContinue=noop,u.prototype.addTrailers=noop,u.prototype.sendDate=noop,e.ResponseError=t,e.dispatch=n,e.registerLocal=c,e.unregisterLocal=p,e.getLocal=h,e.getLocalRegistry=f,e.setRequestDispatcher=a,e.ClientResponse=l,e.ServerResponse=u}(Link),function(e){function t(e){if(!e)throw"no options provided to subscribe";if("string"==typeof e&&(e={url:e}),c)return c(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided to subscribe";return e.urld.protocol||(e.url=window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url)),e.urld.protocol=="httpl"?n(e):r(e)}function n(e){var t=new l(Link.dispatch({method:"get",url:"httpl://"+e.urld.authority+e.urld.relative,headers:{accept:"text/event-stream"},stream:!0}));return t}function r(e){return"undefined"!=typeof window?o(e):i(e)}function o(e){var t=(e.urld.protocol||"http")+"://"+e.urld.authority+e.urld.relative;return new u(t)}function i(){throw"subscribe() has not yet been implemented for nodejs"}function s(e){c=e}function a(){Link.EventEmitter.call(this),this.isConnOpen=!0}function l(e){a.call(this);var t=this;e.then(function(e){e.on("data",function(e){t.__emitEvent(e)}),e.on("end",function(){t.close()})}).except(function(e){t.__emitError({event:"error",data:e}),t.close()})}function u(e){a.call(this),this.eventSource=new EventSource(e);var t=this;this.eventSource.onerror=function(e){e.target.readyState==EventSource.CLOSED&&t.close()}}var c=null;a.prototype=Object.create(Link.EventEmitter.prototype),a.prototype.close=function(){this.isConnOpen=!1,this.removeAllListeners()},a.prototype.__emitError=function(e){this.emit("message",e),this.emit("error",e)},a.prototype.__emitEvent=function(e){this.emit("message",e),this.emit(e.event,e)},l.prototype=Object.create(a.prototype),l.prototype.close=function(){this.__emitError({event:"error",data:void 0}),a.prototype.close.call(this)},u.prototype=Object.create(a.prototype),u.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if(!this._events[e]){var n=this;this.eventSource.addEventListener(e,function(e){var t=e.data;try{t=JSON.parse(t)}catch(r){}n.__emitEvent({event:e.type,data:t})})}Link.EventEmitter.prototype.addListener.call(this,e,t)},u.prototype.on=u.prototype.addListener,u.prototype.close=function(){this.eventSource.close(),this.eventSource.onerror=null,this.eventSource=null,a.prototype.close.call(this)},e.subscribe=t,e.setEventSubscriber=s,e.EventStream=a}(Link),function(e){function t(){return"undefined"!=typeof window?window.location.host:app?app.config.environmentHost:""}function n(e,t,r){this.rel=e,this.relparams=t,this.url=r,this.resolveState=n.UNRESOLVED,this.error=null}function r(e,t){if(this.context=e||null,this.parentNavigator=t||null,this.links=null,typeof this.context=="string")this.context=new n(null,null,e);else if(!t)throw"parentNavigator is required for navigators with relative contexts"}function o(e){return e instanceof r?e:new r(e)}var i=["head","post","put","patch","delete"],s={Json:"application/json",Html:"text/html",Xml:"text/xml",Events:"text/event-stream",Eventstream:"text/event-stream",Plain:"text/plain",Text:"text/plain"},a=["alternate","author","collection","current","describedby","first","index","item","last","latest-version","monitor","monitor-group","next","next-archive","payment","predecessor-version","prev","prev-archive","related","replies","search","self","service","successor-version","up","version-history","via","working-copy","working-copy-of"];n.UNRESOLVED=0,n.RESOLVED=1,n.FAILED=2,n.prototype.isResolved=function(){return this.resolveState===n.RESOLVED},n.prototype.isBad=function(){return this.resolveState>1},n.prototype.isRelative=function(){return!this.url&&!!this.rel},n.prototype.isAbsolute=function(){return!!this.url},n.prototype.getUrl=function(){return this.url},n.prototype.getError=function(){return this.error},n.prototype.getHost=function(){if(!this.host){if(!this.url)return null;var e=Link.parseUri(this.url);this.host=(e.protocol||"http")+"://"+(e.authority||t())}return this.host},n.prototype.resetResolvedState=function(){this.resolveState=n.UNRESOLVED,this.error=null},n.prototype.resolve=function(e){this.error=null,this.resolveState=n.RESOLVED,this.url=e;var t=Link.parseUri(this.url);this.host=(t.protocol||"http")+"://"+t.authority},r.prototype.dispatch=function(e){if(!e||!e.method)throw"request options not provided";var t=this,r=promise();return(e.noresolve?promise(this.context.getUrl()):this.resolve({retry:e.retry})).then(function(o){e.url=o,Link.dispatch(e).then(function(e){return t.context.error=null,t.context.resolveState=n.RESOLVED,t.links=e.headers.link?e.headers.link:t.links||[],e}).except(function(e){return e.response.status===404&&(t.context.error=e,t.context.resolveState=n.FAILED),e}).chain(r)}).except(function(e){r.reject(e)}),r},r.prototype.relation=function(e,t,o){var i=o||{};return i.title=(t||"").toLowerCase(),new r(new n(e,i),this)},r.prototype.resolve=function(e){var t=this,n=promise();return this.links!==null&&(this.context.isResolved()||this.context.isAbsolute()&&this.context.isBad()===!1)?n.fulfill(this.context.getUrl()):this.context.isBad()===!1||this.context.isBad()&&e.retry?(this.context.resetResolvedState(),this.parentNavigator?this.parentNavigator.__resolveChild(this,e).then(function(e){var n=this;t.head(null,null,null,{noresolve:!0}).then(function(){n.fulfill(e)}).except(function(e){n.reject(e)})}).chain(n):this.head(null,null,null,{noresolve:!0}).then(function(){return t.context.getUrl()}).chain(n)):n.reject(this.context.getError()),n},r.prototype.__resolveChild=function(e,t){var r=this,o=promise();return this.resolve(t).then(function(){var t=r.__lookupLink(e.context);t?(e.context.resolve(t),o.fulfill(t)):o.reject(new Link.ResponseError({status:404,reason:"link relation not found"}))}).except(function(t){return e.context.error=t,e.context.resolveState=n.FAILED,o.reject(t),t}),o},r.prototype.__lookupLink=function(e){var t=Link.lookupLink(this.links,e.rel,e.relparams.title);if(t){var n=Link.UriTemplate.parse(t).expand(e.relparams),r=Link.parseUri(n);return r.host||(n=this.context.getHost()+r.relative),n}return console.log("Failed to find a link to resolve context. Target link:",e.rel,e.relparams,"Navigator:",this),null},i.forEach(function(e){r.prototype[e]=function(t,n,r,o){var i=o||{};return i.headers=r||{},i.method=e,null!==t&&"null"!=typeof t&&/head/i.test(e)===!1&&(i.headers["content-type"]=n||("object"==typeof t?"application/json":"text/plain")),i.body=t,this.dispatch(i)}}),r.prototype.get=function(e,t,n){var r=n||{};return r.headers=t||{},r.method="get",r.headers.accept=e,this.dispatch(r)};for(var l in s)(function(e,t){r.prototype["get"+e]=function(e,n){return this.get(t,e,n)}})(l,s[l]);a.forEach(function(e){var t=e.replace(/-/g,"_");r.prototype[t]=function(t,n){return this.relation(e,t,n)}}),e.navigator=o,e.Navigator=r}(Link),function(e){"use strict";function t(e){return Object.prototype.toString.apply(e)==="[object Array]"}function n(e,t,n){var r,o=n;for(r in e)e.hasOwnProperty(r)&&(o=t(o,e[r],r,e));return o}function r(e,t,n){var r,o=n;for(r=0;r<e.length;r+=1)o=t(o,e[r],r,e);return o}function o(e,o,i){return t(e)?r(e,o,i):n(e,o,i)}function i(e){var n,r;if(null===e||void 0===e)return!1;if(t(e)){for(n=0;n<e.length;n+=1)if(i(e[n]))return!0;return!1}if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(r in e)if(e.hasOwnProperty(r)&&i(e[r]))return!0;return!1}function s(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e}function a(e){return e>="0"&&"9">=e}function l(e){return a(e)||e>="a"&&"f">=e||e>="A"&&"F">=e}function u(e){return s(e)||a(e)||"_"===e||w.isPctEncoded(e)}function c(e){return s(e)||a(e)||"-"===e||"."===e||"_"===e||"~"===e}function p(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}function h(e,t){var n,r="",o="";for(("number"==typeof e||"boolean"==typeof e)&&(e=e.toString()),n=0;n<e.length;n+=o.length)o=w.pctCharAt(e,n),r+=o.length>1?o:c(o)||t&&p(o)?o:w.encodeCharacter(o);return r}function f(e){return h(e,!0)}function d(e,t){this.templateText=e,this.expressions=t}function y(e){var t,n="",r="";for(t=0;t<e.length;t+=r.length)r=w.pctCharAt(e,t),n+=r.length>0?r:p(r)||c(r)?r:w.encodeCharacter(r);return n}function v(e){this.literal=y(e)}function g(e,t,n){this.templateText=e,this.operator=t,this.varspecs=n}function m(e){function t(){c={varname:r.substring(p,i),exploded:!1,maxLength:null},p=null}function n(){if(h===i)throw new Error("after a ':' you have to specify the length. position = "+i);c.maxLength=parseInt(r.substring(h,i),10),h=null}var r,o,i,s,l=[],c=null,p=null,h=null;for(r=e.substr(1,e.length-2),i=0;i<r.length;i+=s.length){if(s=w.pctCharAt(r,i),0===i){if(o=L.valueOf(s),o.symbol!==""){p=1;continue}p=0}if(null!==p){if("."===s){if(p===i)throw new Error("a varname MUST NOT start with a dot -- see position "+i);continue}if(u(s))continue;t()}if(null!==h){if(a(s))continue;n()}if(":"!==s)if("*"!==s){if(","!==s)throw new Error("illegal character '"+s+"' at position "+i);l.push(c),c=null,p=i+1}else{if(null===c)throw new Error("explode exploded at position "+i);if(c.exploded)throw new Error("explode exploded twice at position "+i);if(c.maxLength)throw new Error("an explode (*) MUST NOT follow to a prefix, see position "+i);c.exploded=!0}else{if(c.maxLength!==null)throw new Error("only one :maxLength is allowed per varspec at position "+i);h=i+1}}return null!==p&&t(),null!==h&&n(),l.push(c),new g(e,o,l)}var w=function(){function e(e){return unescape(encodeURIComponent(e))}function t(t){var n,r,o="",i=e(t);for(r=0;r<i.length;r+=1)n=i.charCodeAt(r),o+="%"+n.toString(16).toUpperCase();return o}function n(e){if(e.length<3)return!1;for(var t=0;t<e.length;t+=3)if(e.charAt(t)!=="%"||!l(e.charAt(t+1)||!l(e.charAt(t+2))))return!1;return!0}function r(e,t){var r=e.charAt(t);return"%"!==r?r:(r=e.substr(t,3),n(r)?r:"%")}return{encodeCharacter:t,decodeCharacter:decodeURIComponent,isPctEncoded:n,pctCharAt:r}}(),L=function(){function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?f:h,toString:function(){return this.symbol}}}var t={};return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){if(t[e])return t[e];if("=,!@|".indexOf(e)>=0)throw new Error('Illegal use of reserved operator "'+e+'"');return t[""]}}}();d.prototype.toString=function(){return this.templateText},d.prototype.expand=function(e){var t,n="";for(t=0;t<this.expressions.length;t+=1)n+=this.expressions[t].expand(e);return n},v.prototype.expand=function(){return this.literal},v.prototype.toString=v.prototype.expand,g.prototype.toString=function(){return this.templateText},g.prototype.expand=function(e){function n(e,t,n){return i(t)&&(e.length>0&&(e+=","),c||(e+=f.encode(n)+","),e+=f.encode(t)),e}function r(e,t,n){return i(t)&&(e.length>0&&(e+=f.separator),e+=c?y(l.varname):f.encode(n),e+="="+f.encode(t)),e}function s(e,t,n){return i(t)&&(e.length>0&&(e+=f.separator),c||(e+=f.encode(n)+"="),e+=f.encode(t)),e}var a,l,u,c,p="",h=!0,f=this.operator;for(a=0;a<this.varspecs.length;a+=1)if(l=this.varspecs[a],u=e[l.varname],i(u))if(h?(p+=this.operator.first,h=!1):p+=this.operator.separator,c=t(u),"string"==typeof u||"number"==typeof u||"boolean"==typeof u){if(u=u.toString(),this.operator.named){if(p+=y(l.varname),""===u){p+=this.operator.ifEmpty;continue}p+="="}l.maxLength&&u.length>l.maxLength&&(u=u.substr(0,l.maxLength)),p+=this.operator.encode(u)}else{if(l.maxLength)throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+JSON.stringify(u));if(l.exploded)p+=o(u,f.named?r:s,"");else{if(f.named){if(p+=y(l.varname),!i(u)){p+=this.operator.ifEmpty;continue}p+="="}p+=o(u,n,"")}}return p},d.parse=function(e){var t,n,r=[],o=null,i=0;for(t=0;t<e.length;t+=1)if(n=e.charAt(t),null===i){if(null===o)throw new Error("reached unreachable code");if("{"===n)throw new Error("brace was opened in position "+o+" and cannot be reopened in position "+t);if("}"===n){if(o+1===t)throw new Error("empty braces on position "+o);r.push(m(e.substring(o,t+1))),o=null,i=t+1}}else{if("}"===n)throw new Error("brace was closed in position "+t+" but never opened");"{"===n&&(t>i&&r.push(new v(e.substring(i,t))),i=null,o=t)}if(null!==o)throw new Error("brace was opened on position "+o+", but never closed");return i<e.length&&r.push(new v(e.substr(i))),new d(e,r)},e.UriTemplate=d}(Link),"undefined"!=typeof module?module.exports=Link:"undefined"!=typeof define&&define([],function(){return Link}),Link.setRequestDispatcher(function(e){if("function"==typeof e)return local.logStack();var t=promise();return local.postMessage("httpRequest",e,function(n){if(!n.data)throw"Invalid httpRequest reply to worker from document";var r=new Link.ClientResponse(n.data.status,n.data.reason);r.headers=n.data.headers,e.stream||n.data.body===null||typeof n.data.body=="undefined"||r.write(n.data.body),r.status>=200&&r.status<300?t.fulfill(r):(r.status>=400&&r.status<600||!r.status)&&t.reject(new Link.ResponseError(r)),e.stream&&n.data.body!==null&&typeof n.data.body!="undefined"&&r.write(n.data.body),local.onMessage(n.id,function(e){e.name==="endMessage"?r.end():r.write(e.data)})}),t}),Link.setEventSubscriber(function(e){var t=new Link.EventStream,n=local.postMessage("httpSubscribe",e);return t.addListener=t.on=function(e,t){local.postMessage(n,e,function(e){local.onMessage(e.id,function(e){t(e.data)})})},t}),local.onHttpRequest=function(e,t){local.httpRequestHandler=t?function(){return e.apply(t,arguments)}:e},local.setServer=function(e){"function"==typeof e&&(e=new e(arguments[1]||{})),e.config=local.config,local.onHttpRequest(e.handleHttpRequest,e)},local.onMessage("httpRequest",function(e){var t=e.data;if(local.httpRequestHandler){var n=function(t){var n=local.postReply(e,t);t.on("data",function(e){local.postMessage(n,e)}),t.on("end",function(){local.endMessage(n)})},r=function(e){n(e.response)},o=promise();o.then(n).except(r);var i=new Link.ServerResponse(o,t.stream);local.httpRequestHandler(t,i)}else{var s=local.postReply(e,{status:404,reason:"Server not loaded"});local.endMessage(s)}}),local.Server=function(){},local.Server.prototype.handleHttpRequest=function(e,t){t.writeHead(0,"server not implemented"),t.end()};