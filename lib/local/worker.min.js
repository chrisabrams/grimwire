(function(){function t(t){return t&&typeof t.then=="function"}function e(t){this.succeedCBs=[],this.failCBs=[],this.__hasValue=!1,this.__hasFailed=!1,this.value=void 0,t&&this.fulfill(t)}function r(e,r,o){if(null===o)e.isRejected()?r.reject(e.value):r.fulfill(e.value);else{var n;try{n=o(e.value)}catch(i){var a=i.stack||i.message||i.toString();a="[object Object]"==a||a==i?"":'("'+a+'")',console.warn?console.warn("Promise exception thrown",i,a):console.log("Promise exception thrown",i,a),r.reject(i)}t(n)?s(n).chain(r):r.fulfill(n)}}function o(t,e){Array.isArray(t)||(t=[t]);var r=s(),o=t.length,n=0;if(0===o)return r.fulfill([]),r;var i=[];i.length=o;for(var a=[],l=function(t,s,l){i[s]=t,l&&a.push(s),++n==o&&(e?e(i,a)?r.fulfill(i):r.reject(i):r.fulfill(i))},c=0;o>c;c++)s(t[c]).succeed(l,c,!1).fail(l,c,!0);return r}function n(t){return o(t,function(t,e){return e.length===0})}function i(t){return o(t,function(t,e){return e.length<t.length})}function s(r){if(arguments.length>1)return o(Array.prototype.slice.call(arguments));if(r instanceof e)return r;if(t(r)){var n=s();return r.then(function(t){n.fulfill(t)},function(t){n.reject(t)}),n}return new e(r)}var a=this;"undefined"!=typeof window?(typeof window.local=="undefined"&&(window.local={}),a=window.local):"undefined"!=typeof self?(typeof self.local=="undefined"&&(self.local={}),a=self.local):"undefined"!=typeof module&&(a=module.exports),e.prototype.isUnfulfilled=function(){return!this.__hasValue},e.prototype.isRejected=function(){return this.__hasFailed},e.prototype.isFulfilled=function(){return this.__hasValue&&!this.__hasFailed},e.prototype.then=function(t,e){t=t&&"function"==typeof t?t:null,e=e&&"function"==typeof e?e:null;var o=s();if(this.isUnfulfilled())this.succeedCBs.push({p:o,fn:t}),this.failCBs.push({p:o,fn:e});else{var n=this;setTimeout(function(){n.isFulfilled()?r(n,o,t):r(n,o,e)},0)}return o},e.prototype.succeed=function(t){if(this.isRejected())return this;var e=Array.prototype.slice.call(arguments,1);return this.then(function(r){return t.apply(null,[r].concat(e))})},e.prototype.fail=function(t){if(this.isFulfilled())return this;var e=Array.prototype.slice.call(arguments,1);return this.then(null,function(r){return t.apply(null,[r].concat(e))})},e.prototype.fulfill=function(t){if(this.isUnfulfilled()){this.value=t,this.__hasValue=!0;for(var e=0;e<this.succeedCBs.length;e++){var o=this.succeedCBs[e];r(this,o.p,o.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},e.prototype.reject=function(t){if(this.isUnfulfilled()){this.value=t,this.__hasValue=!0,this.__hasFailed=!0;for(var e=0;e<this.failCBs.length;e++){var o=this.failCBs[e];r(this,o.p,o.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},e.prototype.cancel=function(){var t;for(t=0;t<this.succeedCBs.length;t++)this.succeedCBs[t].p.cancel();for(t=0;t<this.failCBs.length;t++)this.failCBs[t].p.cancel();return this.succeedCBs.length=0,this.failCBs.length=0,this},e.prototype.chain=function(t){return this.then(function(e){return s(t).fulfill(e),e},function(e){return s(t).reject(e),e}),t},e.prototype.cb=function(t,e){t?this.reject(t):this.fulfill("undefined"==typeof e?null:e)},a.Promise=e,a.promise=s,a.promise.bundle=o,a.promise.all=n,a.promise.any=i})(),"undefined"!=typeof define&&define([],function(){return Promise}),typeof this.local=="undefined"&&(this.local={}),typeof this.local.util=="undefined"&&(this.local.util={}),function(){function t(){this._events={}}t.prototype.emit=function(t){var e=this._events[t];if(!e)return!1;for(var r=Array.prototype.slice.call(arguments,1),o=0,n=e.length;n>o;o++)e[o].apply(this,r);return!0},t.prototype.addListener=function(t,e){if(Array.isArray(t))return t.forEach(function(t){this.addListener(t,e)},this),void 0;if("function"!=typeof e)throw new Error("addListener only takes instances of Function");return this.emit("newListener",t,e),this._events[t]?this._events[t].push(e):this._events[t]=[e],this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(t,e){var r=this;r.on(t,function o(){r.removeListener(t,o),e.apply(this,arguments)})},t.prototype.removeListener=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");if(!this._events[t])return this;var r=this._events[t],o=r.indexOf(e);return 0>o?this:(r.splice(o,1),r.length===0&&delete this._events[t],this)},t.prototype.removeAllListeners=function(t){return t&&this._events[t]&&(this._events[t]=null),this},t.prototype.listeners=function(t){return this._events[t]},local.util.EventEmitter=t}(),typeof this.local=="undefined"&&(this.local={}),typeof this.local.http=="undefined"&&(this.local.http={}),typeof this.local.http.ext=="undefined"&&(this.local.http.ext={}),function(){function t(){}function e(t){return{getall:function(){return t.headers.link},lookup:function(e,r){return local.http.lookupLink(t.headers.link,e,r)}}}function r(t,e){if(!t||"object"!=typeof t||!e)return t;var r=s(e,"serializer");return r?r(t):t}function o(t,e){if(!t||"string"!=typeof t||!e)return t;var r=s(e,"deserializer");return r?r(t):t}function n(t,e,r){A[t]={serializer:e,deserializer:r}}function i(t){var e=t.split(";"),r=e[0];if(e=r.split("/"),e[1]){var o=e[1].split("+");return o[1]?[r,e[0]+"/"+o[1],e[0]]:[r,e[0]]}return[r]}function s(t,e){for(var r=i(t),o=0;o<r.length;o++)if(r[o]in A)return A[r[o]][e];return null}function a(t,e){e.status>=200&&e.status<400?t.fulfill(e):e.status>=400&&e.status<600||e.status===0?t.reject(e):t.fulfill(e)}function l(t,e){var r=_[t.urld.host];if(!r){var o=new h(404,"server not found");return e.reject(o),o.end(),void 0}var n={path:t.urld.path,method:t.method,query:t.query||{},headers:t.headers||{},body:t.body,stream:t.stream};if(t.urld.query){var i=local.http.contentTypes.deserialize(t.urld.query,"application/x-www-form-urlencoded");for(var s in i)n.query[s]=i[s]}r.fn.call(r.context,n,new f(e,t.stream))}function c(t,e){if(t.query){var r=local.http.contentTypes.serialize(t.query,"application/x-www-form-urlencoded");r&&(t.urld.query?(t.urld.query+="&"+r,t.urld.relative+="&"+r):(t.urld.query=r,t.urld.relative+="?"+r))}"undefined"!=typeof window?u(t,e):p(t,e)}function u(t,e){var r=(t.urld.protocol?t.urld.protocol+"://":"")+t.urld.authority+t.urld.relative;local.http.serializeRequestHeaders(t.headers),t.body!==null&&typeof t.body!="undefined"&&(t.headers["content-type"]=t.headers["content-type"]||"application/json",typeof t.body!="string"&&(t.body=local.http.contentTypes.serialize(t.body,t.headers["content-type"])));var o=new XMLHttpRequest;o.open(t.method,r,!0);for(var n in t.headers)t.headers[n]!==null&&t.headers.hasOwnProperty(n)&&o.setRequestHeader(n,t.headers[n]);var i,s=0,l=0;o.onreadystatechange=function(){o.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!i&&(i=new h(o.status,o.statusText),o.getAllResponseHeaders().split("\n").forEach(function(t){if(t){var e=t.toLowerCase().replace("\r","").split(": ");i.headers[e[0]]=e[1]}}),i.headers.link&&(i.headers.link=local.http.parseLinkHeader(i.headers.link)),t.stream&&(a(e,i),s=setInterval(function(){var t=o.responseText.length;t>l&&(l=t,i.write(o.responseText,!0))},t.streamPoll||500))),o.readyState===XMLHttpRequest.DONE&&(i=i||new h(o.status,o.statusText),s&&clearInterval(s),i.write(o.responseText,!0),i.end(),t.stream||a(e,i))},o.send(t.body)}function p(t,e){var r=new h(0,"dispatch() has not yet been implemented for nodejs");e.reject(r),r.end()}function h(t,e){local.util.EventEmitter.call(this),this.status=t,this.reason=e,this.headers={},this.body=null,this.isConnOpen=!0}function f(t,e){local.util.EventEmitter.call(this),this.resPromise=t,this.isStreaming=e,this.clientResponse=new h}function d(t){var e=new w(local.http.dispatch({method:"get",url:"httpl://"+t.urld.authority+t.urld.relative,headers:{accept:"text/event-stream"},stream:!0}));return e}function v(t){return"undefined"!=typeof window?y(t):m(t)}function y(t){var e=(t.urld.protocol||"http")+"://"+t.urld.authority+t.urld.relative;return new b(e)}function m(){throw"subscribe() has not yet been implemented for nodejs"}function g(){local.util.EventEmitter.call(this),this.isConnOpen=!0}function w(t){g.call(this);var e=this;t.then(function(t){t.on("data",function(t){e.__emitEvent(t)}),t.on("end",function(){e.close()})},function(t){e.__emitError({event:"error",data:t}),e.close()})}function b(t){g.call(this),this.eventSource=new EventSource(t);var e=this;this.eventSource.onerror=function(t){t.target.readyState==EventSource.CLOSED&&e.close()}}function x(){this.streams=[]}function k(){return"undefined"!=typeof window?window.location.host:app?app.config.environmentHost:""}function E(t,e,r){this.rel=t,this.relparams=e,this.url=r,this.resolveState=E.UNRESOLVED,this.error=null}function L(t,e){if(this.context=t||null,this.parentNavigator=e||null,this.links=null,typeof this.context=="string")this.context=new E(null,null,t);else if(!e)throw"parentNavigator is required for navigators with relative contexts"}local.http.relAliases={storage:"http://grimwire.com/rel/storage"},local.http.reqheader=function(t,r,o){if("undefined"==typeof o)switch(r){case"link":return e(t);default:return t.headers[r]}else switch(r){case"link":t.headers.link||(t.headers.link=[]),Array.isArray(t.headers.link)===!1&&(console.warn("Overwrote a bad Link header on request:",t),t.headers.link=[]),o&&"object"==typeof o&&o.href&&o.rel?t.headers.link.push(o):console.warn("Malformed Link header value given to request:",t,o);break;default:t.headers[r]=o}},local.http.reqapi=function(t,e){switch(e){case"storage":return local.http.navigator(local.http.reqheader(t,"link").lookup("storage"))}throw"Unrecognized reqapi: "+e},local.http.parseLinkHeader=function(t){return"string"!=typeof t?t:t.replace(/,[\s]*</g,"|||<").split("|||").map(function(t){var e={};return t.trim().split(";").forEach(function(t){if(t=t.trim())if(t.charAt(0)==="<")e.href=t.trim().slice(1,-1);else{var r=t.split("="),o=r[0].trim(),n=r[1].trim().slice(1,-1);e[o]=n}}),e})},local.http.lookupLink=function(t,e,r){var o=t?t.length:0;if(!o)return null;e=local.http.relAliases[e]||e,r&&(r=r.toLowerCase());for(var n=null,i=0;o>i;i++){var s=t[i];if(s&&s.rel&&s.rel.indexOf(e)!==-1)if(r&&s.title){if(s.title.toLowerCase()===r){n=s;break}}else n=s}return n?n.href:null},local.http.joinUrl=function(){var t=Array.prototype.map.call(arguments,function(t){var e=0,r=t.length;return t.charAt(0)==="/"&&(e+=1),t.charAt(r-1)==="/"&&(r-=1),t.substring(e,r)});return t.join("/")},local.http.serializeRequestHeaders=function(t){if(t.authorization&&typeof t.authorization=="object"){if(!t.authorization.scheme)throw"`scheme` required for auth headers";var e;switch(t.authorization.scheme.toLowerCase()){case"basic":e="Basic "+btoa(t.authorization.name+":"+t.authorization.password);break;case"persona":e="Persona name="+t.authorization.name+" assertion="+t.authorization.assertion;break;default:throw"unknown auth sceme: "+t.authorization.scheme}t.authorization=e}},local.http.parseUri=function(t){"object"==typeof t&&(t.url?t=t.url:(t.host||t.path)&&(t=local.http.joinUrl(req.host,req.path)));for(var e=local.http.parseUri.options,r=e.parser[e.strictMode?"strict":"loose"].exec(t),o={},n=14;n--;)o[e.key[n]]=r[n]||"";return o[e.q.name]={},o[e.key[12]].replace(e.q.parser,function(t,r,n){r&&(o[e.q.name][r]=n)}),o},local.http.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},local.http.pipe=function(t,e,r,o){return r=r||function(t){return t},o=o||function(t){return t},local.promise(e).succeed(function(e){return t.status||t.writeHead(e.status,e.reason,r(e.headers)),e.body!==null&&typeof e.body!="undefined"&&t.write(o(e.body)),e.on&&e.isConnOpen?(e.on("data",function(e){t.write(o(e))}),e.on("end",function(){t.end()})):t.end(),t}).fail(function(e){var r=e.headers["content-type"]||"text/plain",o=r&&e.body?e.body:"";throw t.writeHead(502,"bad gateway",{"content-type":r}),t.end(o),e})};var S={serialize:r,deserialize:o,register:n},A={};local.http.contentTypes=S,local.http.contentTypes.register("application/json",function(t){try{return JSON.stringify(t)}catch(e){return e.message}},function(t){try{return JSON.parse(t)}catch(e){return e.message}}),local.http.contentTypes.register("application/x-www-form-urlencoded",function(t){var e=encodeURIComponent,r=[];for(var o in t)if(t[o]===null)r.push(o+"=");else if(Array.isArray(t[o]))for(var n=0;n<t[o].length;n++)r.push(o+"[]="+e(t[o][n]));else if(typeof t[o]=="object")for(var i in t[o])r.push(o+"["+i+"]="+e(t[o][i]));else r.push(o+"="+e(t[o]));return r.join("&")},function(t){for(var e=t.split("&"),r={},o=0;o<e.length;o++){var n=e[o].split("="),i=decodeURIComponent(n[0]),s=decodeURIComponent(n[1]),a=/\[\]$/.test(i),l=i.match(/^(.+)\[([^\]]+)\]$/);if(l){i=l[1];var c=l[2];r[i]=r[i]||{},r[i][c]=s}else a?(i=i.substring(0,i.length-2),r[i]=r[i]||[],r[i].push(s)):r[i]=s}return r});var _={},R=null,C="undefined"!=typeof window?window.location.pathname.split("/"):[""];C[C.length-1]="",C=C.join("/"),local.http.dispatch=function(t){if(!t)throw"no req param provided to request";if(t.headers=t.headers||{},t.query=t.query||{},R)return R(t);if(t.url||(t.url=local.http.joinUrl(t.host,t.path)),t.urld||(t.urld=local.http.parseUri(t.url)),!t.urld)throw"no URL or host/path provided in request";t.urld.protocol||(t.url=t.url.length>0&&t.url.charAt(0)!="/"?window.location.protocol+"//"+window.location.host+C+t.url:window.location.protocol+"//"+window.location.host+t.url,t.urld=local.http.parseUri(t.url));var e=local.promise();if(t.urld.protocol=="httpl")setTimeout(function(){l(t,e)},0);else if(t.urld.protocol=="http"||t.urld.protocol=="https")setTimeout(function(){c(t,e)},0);else{var r=new h(0,'unsupported protocol "'+t.urld.protocol+'"');e.reject(r),r.end()}return e},local.http.setRequestDispatcher=function(t){R=t},local.http.ClientResponse=h,h.prototype=Object.create(local.util.EventEmitter.prototype),h.prototype.write=function(t,e){if(e||"string"!=typeof t||typeof this.body!="string"){var r=this.body&&typeof this.body=="string"?this.body.length:0;this.body=t,t="string"==typeof t?t.slice(r):t}else this.body+=t;this.emit("data",t)},h.prototype.end=function(){this.__deserialize(),this.isConnOpen=!1,this.emit("end")},h.prototype.__deserialize=function(){typeof this.body=="string"&&(this.body=local.http.contentTypes.deserialize(this.body,this.headers["content-type"]))},local.http.ServerResponse=f,f.prototype=Object.create(local.util.EventEmitter.prototype),f.prototype.writeHead=function(t,e,r){this.clientResponse.status=t,this.clientResponse.reason=e;for(var o in r)r.hasOwnProperty(o)&&this.setHeader(o,r[o]);return this.isStreaming&&a(this.resPromise,this.clientResponse),this},f.prototype.setHeader=function(t,e){this.clientResponse.headers[t]=e},f.prototype.getHeader=function(t){return this.clientResponse.headers[t]},f.prototype.removeHeader=function(t){delete this.clientResponse.headers[t]},f.prototype.write=function(t){return this.clientResponse.write(t,!1),this},f.prototype.end=function(t){return t&&this.write(t),this.clientResponse.end(),this.emit("close"),this.isStreaming||a(this.resPromise,this.clientResponse),this.removeAllListeners("close"),this.clientResponse.removeAllListeners("data"),this.clientResponse.removeAllListeners("end"),this},f.prototype.writeContinue=t,f.prototype.addTrailers=t,f.prototype.sendDate=t,local.http.registerLocal=function(t,e,r){var o=local.http.parseUri(t);if(o.protocol&&o.protocol!=="httpl")throw"registerLocal can only add servers to the httpl protocol";if(!o.host)throw"invalid domain provided to registerLocal";if(_[o.host])throw"server already registered at domain given to registerLocal";_[o.host]={fn:e,context:r}},local.http.unregisterLocal=function(t){var e=local.http.parseUri(t);if(!e.host)throw"invalid domain provided toun registerLocal";_[e.host]&&delete _[e.host]},local.http.getLocal=function(t){var e=local.http.parseUri(t);if(!e.host)throw"invalid domain provided toun registerLocal";return _[e.host]},local.http.getLocalRegistry=function(){return _};var C="undefined"!=typeof window?window.location.pathname.split("/"):[""];C[C.length-1]="",C=C.join("/");var j=null;local.http.subscribe=function(t){if(!t)throw"no options provided to subscribe";if("string"==typeof t&&(t={url:t}),j)return j(t);if(t.url||(t.url=local.http.joinUrl(t.host,t.path)),t.urld=local.http.parseUri(t.url),!t.urld)throw"no URL or host/path provided in request";return t.urld.protocol||(t.url=t.url.length>0&&t.url.charAt(0)!="/"?window.location.protocol+"//"+window.location.host+C+t.url:window.location.protocol+"//"+window.location.host+t.url,t.urld=local.http.parseUri(t.url)),t.urld.protocol=="httpl"?d(t):v(t)},local.http.setEventSubscriber=function(t){j=t},local.http.EventStream=g,g.prototype=Object.create(local.util.EventEmitter.prototype),g.prototype.close=function(){this.isConnOpen=!1,this.removeAllListeners()},g.prototype.__emitError=function(t){this.emit("message",t),this.emit("error",t)},g.prototype.__emitEvent=function(t){this.emit("message",t),this.emit(t.event,t)},local.http.LocalEventStream=w,w.prototype=Object.create(g.prototype),w.prototype.close=function(){this.__emitError({event:"error",data:void 0}),g.prototype.close.call(this)},local.http.BrowserRemoteEventStream=b,b.prototype=Object.create(g.prototype),b.prototype.addListener=function(t,e){if(Array.isArray(t))return t.forEach(function(t){this.addListener(t,e)},this),void 0;if(!this._events[t]){var r=this;this.eventSource.addEventListener(t,function(t){var e=t.data;try{e=JSON.parse(e)}catch(o){}r.__emitEvent({event:t.type,data:e})})}local.util.EventEmitter.prototype.addListener.call(this,t,e)},b.prototype.on=b.prototype.addListener,b.prototype.close=function(){this.eventSource.close(),this.eventSource.onerror=null,this.eventSource=null,g.prototype.close.call(this)},local.http.Broadcaster=x,x.prototype.addStream=function(t){this.streams.push(t)},x.prototype.endStream=function(t){this.streams=this.streams.filter(function(e){return e!=t}),t.end()},x.prototype.endAllStreams=function(){this.streams.forEach(function(t){t.end()}),this.streams.length=0},x.prototype.emit=function(t,e){this.streams.forEach(function(r){this.emitTo(r,t,e)},this)},x.prototype.emitTo=function(t,e,r){t.write({event:e,data:r})},local.http.broadcaster=function(){return new x},function(){"use strict";function t(t){return Object.prototype.toString.apply(t)==="[object Array]"}function e(t,e,r){var o,n=r;for(o in t)t.hasOwnProperty(o)&&(n=e(n,t[o],o,t));return n}function r(t,e,r){var o,n=r;for(o=0;o<t.length;o+=1)n=e(n,t[o],o,t);return n}function o(o,n,i){return t(o)?r(o,n,i):e(o,n,i)}function n(e){var r,o;if(null===e||void 0===e)return!1;if(t(e)){for(r=0;r<e.length;r+=1)if(n(e[r]))return!0;return!1}if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(o in e)if(e.hasOwnProperty(o)&&n(e[o]))return!0;return!1}function i(t){return t>="a"&&"z">=t||t>="A"&&"Z">=t}function s(t){return t>="0"&&"9">=t}function a(t){return s(t)||t>="a"&&"f">=t||t>="A"&&"F">=t}function l(t){return i(t)||s(t)||"_"===t||g.isPctEncoded(t)}function c(t){return i(t)||s(t)||"-"===t||"."===t||"_"===t||"~"===t}function u(t){return":"===t||"/"===t||"?"===t||"#"===t||"["===t||"]"===t||"@"===t||"!"===t||"$"===t||"&"===t||"("===t||")"===t||"*"===t||"+"===t||","===t||";"===t||"="===t||"'"===t}function p(t,e){var r,o="",n="";for(("number"==typeof t||"boolean"==typeof t)&&(t=t.toString()),r=0;r<t.length;r+=n.length)n=g.pctCharAt(t,r),o+=n.length>1?n:c(n)||e&&u(n)?n:g.encodeCharacter(n);return o}function h(t){return p(t,!0)}function f(t,e){this.templateText=t,this.expressions=e}function d(t){var e,r="",o="";for(e=0;e<t.length;e+=o.length)o=g.pctCharAt(t,e),r+=o.length>0?o:u(o)||c(o)?o:g.encodeCharacter(o);return r}function v(t){this.literal=d(t)}function y(t,e,r){this.templateText=t,this.operator=e,this.varspecs=r}function m(t){function e(){u={varname:o.substring(p,i),exploded:!1,maxLength:null},p=null}function r(){if(h===i)throw new Error("after a ':' you have to specify the length. position = "+i);u.maxLength=parseInt(o.substring(h,i),10),h=null}var o,n,i,a,c=[],u=null,p=null,h=null;for(o=t.substr(1,t.length-2),i=0;i<o.length;i+=a.length){if(a=g.pctCharAt(o,i),0===i){if(n=w.valueOf(a),n.symbol!==""){p=1;continue}p=0}if(null!==p){if("."===a){if(p===i)throw new Error("a varname MUST NOT start with a dot -- see position "+i);continue}if(l(a))continue;e()}if(null!==h){if(s(a))continue;r()}if(":"!==a)if("*"!==a){if(","!==a)throw new Error("illegal character '"+a+"' at position "+i);c.push(u),u=null,p=i+1}else{if(null===u)throw new Error("explode exploded at position "+i);if(u.exploded)throw new Error("explode exploded twice at position "+i);if(u.maxLength)throw new Error("an explode (*) MUST NOT follow to a prefix, see position "+i);u.exploded=!0}else{if(u.maxLength!==null)throw new Error("only one :maxLength is allowed per varspec at position "+i);h=i+1}}return null!==p&&e(),null!==h&&r(),c.push(u),new y(t,n,c)}var g=function(){function t(t){return unescape(encodeURIComponent(t))}function e(e){var r,o,n="",i=t(e);for(o=0;o<i.length;o+=1)r=i.charCodeAt(o),n+="%"+r.toString(16).toUpperCase();return n}function r(t){if(t.length<3)return!1;for(var e=0;e<t.length;e+=3)if(t.charAt(e)!=="%"||!a(t.charAt(e+1)||!a(t.charAt(e+2))))return!1;return!0}function o(t,e){var o=t.charAt(e);return"%"!==o?o:(o=t.substr(e,3),r(o)?o:"%")}return{encodeCharacter:e,decodeCharacter:decodeURIComponent,isPctEncoded:r,pctCharAt:o}}(),w=function(){function t(t){e[t]={symbol:t,separator:"?"===t?"&":""===t||"+"===t||"#"===t?",":t,named:";"===t||"&"===t||"?"===t,ifEmpty:"&"===t||"?"===t?"=":"",first:"+"===t?"":t,encode:"+"===t||"#"===t?h:p,toString:function(){return this.symbol}}}var e={};return t(""),t("+"),t("#"),t("."),t("/"),t(";"),t("?"),t("&"),{valueOf:function(t){if(e[t])return e[t];if("=,!@|".indexOf(t)>=0)throw new Error('Illegal use of reserved operator "'+t+'"');return e[""]}}}();f.prototype.toString=function(){return this.templateText},f.prototype.expand=function(t){var e,r="";for(e=0;e<this.expressions.length;e+=1)r+=this.expressions[e].expand(t);return r},v.prototype.expand=function(){return this.literal},v.prototype.toString=v.prototype.expand,y.prototype.toString=function(){return this.templateText},y.prototype.expand=function(e){function r(t,e,r){return n(e)&&(t.length>0&&(t+=","),u||(t+=f.encode(r)+","),t+=f.encode(e)),t}function i(t,e,r){return n(e)&&(t.length>0&&(t+=f.separator),t+=u?d(l.varname):f.encode(r),t+="="+f.encode(e)),t}function s(t,e,r){return n(e)&&(t.length>0&&(t+=f.separator),u||(t+=f.encode(r)+"="),t+=f.encode(e)),t}var a,l,c,u,p="",h=!0,f=this.operator;for(a=0;a<this.varspecs.length;a+=1)if(l=this.varspecs[a],c=e[l.varname],n(c))if(h?(p+=this.operator.first,h=!1):p+=this.operator.separator,u=t(c),"string"==typeof c||"number"==typeof c||"boolean"==typeof c){if(c=c.toString(),this.operator.named){if(p+=d(l.varname),""===c){p+=this.operator.ifEmpty;continue}p+="="}l.maxLength&&c.length>l.maxLength&&(c=c.substr(0,l.maxLength)),p+=this.operator.encode(c)}else{if(l.maxLength)throw new Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+JSON.stringify(c));if(l.exploded)p+=o(c,f.named?i:s,"");else{if(f.named){if(p+=d(l.varname),!n(c)){p+=this.operator.ifEmpty;continue}p+="="}p+=o(c,r,"")}}return p},f.parse=function(t){var e,r,o=[],n=null,i=0;for(e=0;e<t.length;e+=1)if(r=t.charAt(e),null===i){if(null===n)throw new Error("reached unreachable code");if("{"===r)throw new Error("brace was opened in position "+n+" and cannot be reopened in position "+e);if("}"===r){if(n+1===e)throw new Error("empty braces on position "+n);o.push(m(t.substring(n,e+1))),n=null,i=e+1}}else{if("}"===r)throw new Error("brace was closed in position "+e+" but never opened");"{"===r&&(e>i&&o.push(new v(t.substring(i,e))),i=null,n=e)}if(null!==n)throw new Error("brace was opened on position "+n+", but never closed");return i<t.length&&o.push(new v(t.substr(i))),new f(t,o)},local.http.UriTemplate=f}();var q=["head","post","put","patch","delete"],U={Json:"application/json",Html:"text/html",Xml:"text/xml",Events:"text/event-stream",Eventstream:"text/event-stream",Plain:"text/plain",Text:"text/plain"},O=["alternate","author","collection","current","describedby","first","index","item","last","latest-version","monitor","monitor-group","next","next-archive","payment","predecessor-version","prev","prev-archive","related","replies","search","self","service","successor-version","up","version-history","via","working-copy","working-copy-of"];E.UNRESOLVED=0,E.RESOLVED=1,E.FAILED=2,E.prototype.isResolved=function(){return this.resolveState===E.RESOLVED},E.prototype.isBad=function(){return this.resolveState>1},E.prototype.isRelative=function(){return!this.url&&!!this.rel},E.prototype.isAbsolute=function(){return!!this.url},E.prototype.getUrl=function(){return this.url},E.prototype.getError=function(){return this.error},E.prototype.getHost=function(){if(!this.host){if(!this.url)return null;var t=local.http.parseUri(this.url);this.host=(t.protocol||"http")+"://"+(t.authority||k())}return this.host},E.prototype.resetResolvedState=function(){this.resolveState=E.UNRESOLVED,this.error=null},E.prototype.resolve=function(t){this.error=null,this.resolveState=E.RESOLVED,this.url=t;var e=local.http.parseUri(this.url);this.host=(e.protocol||"http")+"://"+e.authority},local.http.Navigator=L,L.prototype.dispatch=function(t){if(!t||!t.method)throw"request options not provided";var e=this,r=local.promise();return(t.noresolve?local.promise(this.context.getUrl()):this.resolve({retry:t.retry,nohead:!0})).succeed(function(e){return t.url=e,local.http.dispatch(t)}).succeed(function(t){return e.context.error=null,e.context.resolveState=E.RESOLVED,e.links=t.headers.link?t.headers.link:e.links||[],t}).fail(function(t){throw t.status===404&&(e.context.error=t,e.context.resolveState=E.FAILED),t}).chain(r),r},L.prototype.subscribe=function(){return this.resolve().succeed(function(t){return local.http.subscribe(t)})},L.prototype.relation=function(t,e,r){var o=r||{};return o.title=(e||"").toLowerCase(),new L(new E(t,o),this)},L.prototype.resolve=function(t){var e=this;t=t||{};var r=t.nohead;delete t.nohead;var o=local.promise();return this.links!==null&&(this.context.isResolved()||this.context.isAbsolute()&&this.context.isBad()===!1)?o.fulfill(this.context.getUrl()):this.context.isBad()===!1||this.context.isBad()&&t.retry?(this.context.resetResolvedState(),this.parentNavigator?this.parentNavigator.__resolveChild(this,t).succeed(function(){return r?!0:e.head(null,null,null,{noresolve:!0})}).succeed(function(){return e.context.getUrl()}).chain(o):(r?local.promise(!0):this.head(null,null,null,{noresolve:!0})).succeed(function(){return e.context.getUrl()}).chain(o)):o.reject(this.context.getError()),o},L.prototype.__resolveChild=function(t,e){var r=this,o=local.promise();return this.resolve(e).then(function(){var e=r.__lookupLink(t.context);if(e)t.context.resolve(e),o.fulfill(e);else{var n=new local.http.ClientResponse(404,"link relation not found");o.reject(n),n.end()}},function(e){return t.context.error=e,t.context.resolveState=E.FAILED,o.reject(e),e}),o},L.prototype.__lookupLink=function(t){var e=local.http.lookupLink(this.links,t.rel,t.relparams.title);if(e){var r=local.http.UriTemplate.parse(e).expand(t.relparams),o=local.http.parseUri(r);return o.host||(r=this.context.getHost()+o.relative),r}return console.log("Failed to find a link to resolve context. Target link:",t.rel,t.relparams,"Navigator:",this),null},q.forEach(function(t){L.prototype[t]=function(e,r,o,n){var i=n||{};return i.headers=o||{},i.method=t,null!==e&&"null"!=typeof e&&/head/i.test(t)===!1&&(i.headers["content-type"]=r||("object"==typeof e?"application/json":"text/plain")),i.body=e,this.dispatch(i)}}),L.prototype.get=function(t,e,r){var o=r||{};return o.headers=e||{},o.method="get",o.headers.accept=t,this.dispatch(o)};for(var M in U)(function(t,e){L.prototype["get"+t]=function(t,r){return this.get(e,t,r)}})(M,U[M]);O.forEach(function(t){var e=t.replace(/-/g,"_");L.prototype[e]=function(e,r){return this.relation(t,e,r)}}),local.http.navigator=function(t){return t instanceof L?t:new L(t)}}(),typeof this.local=="undefined"&&(this.local={}),typeof this.local.worker=="undefined"&&(this.local.worker={}),function(){function t(t,e){var r=t.charCodeAt(e)&255;return r}function e(t,e){return e="(function(){ var module = { exports:{} }; "+e+'; self.modules["'+t+'"] = module.exports; })();',"data:text/javascript;base64,"+btoa(e)}(function(){function t(){return o++}function e(e,r,o){var n={id:t(),reply_to:o,name:e,data:r};return n}function r(t,e,r){e&&"function"==typeof e&&(n[t.id]={func:e,context:r}),self.postMessage(t)}var o=1,n={},i={};self.addEventListener("message",function(t){var e=t.data;if(e.name==="reply"){var r=n[e.reply_to];if(r)return r.func.call(r.context,e),delete n[e.reply_to],void 0}var o=i[e.name];if(e.name==="endMessage"){var s=e.data;o=i[s],local.worker.removeAllNamedMessageListeners(s)}o&&o.forEach(function(t){t.func.call(t.context,e)})}),local.worker.postNamedMessage=function(t,o,n,i){var s=e(t,o);return r(s,n,i),s.id},local.worker.postReply=function(t,o,n,i){var s="object"==typeof t?t.id:t,a=e("reply",o,s);return r(a,n,i),a.id},local.worker.endMessage=function(t){return local.worker.postNamedMessage("endMessage",t)},local.worker.addNamedMessageListener=function(t,e,r){t in i||(i[t]=[]),i[t].push({func:e,context:r})},local.worker.onNamedMessage=local.worker.addNamedMessageListener,local.worker.removeNamedMessageListener=function(t,e){if(t in i){var r=function(t){return t.func!=e};i[t]=i[t].filter(r),i[t].length===0&&delete i[t]}},local.worker.removeAllNamedMessageListeners=function(t){t in i&&delete i[t]}})(),local.http.setRequestDispatcher(function(t){if("function"==typeof t)return local.worker.logStack();var e=local.promise();return local.worker.postNamedMessage("httpRequest",t,function(r){if(!r.data)throw"Invalid httpRequest reply to worker from document";var o=new local.http.ClientResponse(r.data.status,r.data.reason);o.headers=r.data.headers,!t.stream&&r.data.body&&o.write(r.data.body),o.status>=200&&o.status<300?e.fulfill(o):o.status>=400||!o.status?e.reject(o):e.fulfill(o),t.stream&&r.data.body&&o.write(r.data.body),local.worker.onNamedMessage(r.id,function(t){t.name==="endMessage"?o.end():o.write(t.data)})}),e}),local.http.setEventSubscriber(function(t){var e=new local.http.EventStream,r=local.worker.postNamedMessage("httpSubscribe",t);return e.addListener=e.on=function(t,e){local.worker.postNamedMessage(r,t,function(t){local.worker.onNamedMessage(t.id,function(t){e(t.data)})})},e}),local.worker.onNamedMessage("httpRequest",function(t){var e=t.data;if(main){var r=function(e){var r=local.worker.postReply(t,e);e.isConnOpen?(e.on("data",function(t){local.worker.postNamedMessage(r,t)}),e.on("end",function(){local.worker.endMessage(r)})):local.worker.endMessage(r)},o=local.promise();o.then(r,r);var n=new local.http.ServerResponse(o,e.stream);main(e,n)}else{var i=local.worker.postReply(t,{status:404,reason:"server not loaded"});local.worker.endMessage(i)}});var r=importScripts,o=XMLHttpRequest;if(local.worker.log=function(){var t=Array.prototype.slice.call(arguments);t.length>1?local.worker.postNamedMessage("log",t):local.worker.postNamedMessage("log",t[0])},self.console={},self.console.log=local.worker.log,local.worker.logStack=function(){try{stack_trace._fake+=0}catch(t){console.log(t.stack)}},!self.btoa){var n="=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
self.btoa=function(e){var r,o,s=n,a=i,l=[];e=""+e;var c=e.length-e.length%3;if(e.length===0)return e;for(r=0;c>r;r+=3)o=t(e,r)<<16|t(e,r+1)<<8|t(e,r+2),l.push(a.charAt(o>>18)),l.push(a.charAt(63&o>>12)),l.push(a.charAt(63&o>>6)),l.push(a.charAt(63&o));switch(e.length-c){case 1:o=t(e,r)<<16,l.push(a.charAt(o>>18)+a.charAt(63&o>>12)+s+s);break;case 2:o=t(e,r)<<16|t(e,r+1)<<8,l.push(a.charAt(o>>18)+a.charAt(63&o>>12)+a.charAt(63&o>>6)+s)}return l.join("")}}self.require=function(t){if(t in self.modules)return self.modules[t];local.worker.config&&t.indexOf("://")===-1&&t.charAt(0)!="/"&&(t=local.worker.config.srcBaseUrl+t);var n=new o;return n.open("GET",t,!1),n.send(null),n.status>=200&&n.status<300?/\.js$/.test(t)?(r(e(t,n.responseText)),self.modules[t]):(self.modules[t]=n.responseText,n.responseText):(console.log("Failed to require("+t+") - "+n.status),null)},self.modules={},local.worker.onNamedMessage("nullify",function(t){if(console.log("nullifying: "+t.data),!t||typeof t.data!="string")throw"'nullify' message must include a valid string";self[t.data]=null}),local.worker.onNamedMessage("importScripts",function(t){if(console.log("importingScripts: "+t.data),!t||!t.data)throw"'importScripts' message must include a valid array/string";try{r(t.data)}catch(e){throw local.worker.postReply(t,{error:!0,reason:e.toString()}),e}local.worker.postReply(t,{error:!1})}),local.worker.postNamedMessage("ready",null,function(t){local.worker.config=t.data})}();