function noop(){}"undefined"==typeof localApp?function(){function e(){return n++}function t(t,r,n){var o={id:e(),reply_to:n,name:t,data:r};return o}function r(e,t,r){t&&"function"==typeof t&&(localApp.replyCbs[e.id]={func:t,context:r}),self.postMessage(e)}var n=1;self.localApp={replyCbs:{},messageListeners:{}},self.addEventListener("message",function(e){var t=e.data;if("reply"===t.name){var r=localApp.replyCbs[t.reply_to];if(r)return r.func.call(r.context,t),delete localApp.replyCbs[t.reply_to],void 0}var n=localApp.messageListeners[t.name];if("endMessage"===t.name){var o=t.data;n=localApp.messageListeners[o],localApp.removeAllMessageListeners(o)}n&&n.forEach(function(e){e.func.call(e.context,t)})}),localApp.postMessage=function(e,n,o,i){var s=t(e,n);return r(s,o,i),s.id},localApp.postReply=function(e,n,o,i){var s="object"==typeof e?e.id:e,a=t("reply",n,s);return r(a,o,i),a.id},localApp.endMessage=function(e){return this.postMessage("endMessage",e)},localApp.addMessageListener=function(e,t,r){e in localApp.messageListeners||(localApp.messageListeners[e]=[]),localApp.messageListeners[e].push({func:t,context:r})},localApp.onMessage=localApp.addMessageListener,localApp.removeMessageListener=function(e,t){if(e in localApp.messageListeners){var r=function(e){return e.func!=t};localApp.messageListeners[e]=localApp.messageListeners[e].filter(r),0===localApp.messageListeners[e].length&&delete localApp.messageListeners[e]}},localApp.removeAllMessageListeners=function(e){e in localApp.messageListeners&&delete localApp.messageListeners[e]},localApp.log=function(){var e=Array.prototype.slice.call(arguments);e.length>1?localApp.postMessage("log",e):localApp.postMessage("log",e[0])},localApp.logStack=function(){try{stack_trace._fake+=0}catch(e){localApp.log(e.stack)}},localApp.onMessage("nullify",function(e){if(localApp.log("nullifying: "+e.data),!e||"string"!=typeof e.data)throw"'nullify' message must include a valid string";self[e.data]=null}),localApp.onMessage("importScripts",function(e){if(localApp.log("importingScripts: "+e.data),!e||!e.data)throw"'importScripts' message must include a valid array/string";try{self.importScripts(e.data)}catch(t){throw localApp.postReply(e,{error:!0,reason:""+t}),t}localApp.postReply(e,{error:!1})}),localApp.postMessage("ready",null,function(e){localApp.config=e.data})}():null;var console={};console.log=localApp.log,function(){function e(e){return e&&"function"==typeof e.then}function t(e){this.succeedCBs=[],this.failCBs=[],this.__hasValue=!1,this.__hasFailed=!1,this.value=void 0,e&&this.fulfill(e)}function r(t,r,n){if(null===n)t.isRejected()?r.reject(t.value):r.fulfill(t.value);else{var o;try{o=n(t.value)}catch(i){console.error?console.error("Promise exception thrown",i,'("'+(""+i)+'")'):console.log("Promise exception thrown",i,'("'+(""+i)+'")'),r.reject(i)}e(o)?a(o).chain(r):r.fulfill(o)}}function n(e){return function(t,r){return t?e.reject(t):e.fulfill(r===void 0?null:r)}}function o(e,t){Array.isArray(e)||(e=[e]);var r=a(),n=e.length,o=0;if(0===n)return r.fulfill([]),r;var i=[];i.length=n;for(var s=[],l=function(e,a,l){i[a]=e,l&&s.push(a),++o==n&&(t?t(i,s)?r.fulfill(i):r.reject(i):r.fulfill(i))},u=0;n>u;u++)a(e[u]).succeed(l,u,!1).fail(l,u,!0);return r}function i(e){return o(e,function(e,t){return 0===t.length})}function s(e){return o(e,function(e,t){return t.length<e.length})}function a(r){if(arguments.length>1)return o(Array.prototype.slice.call(arguments));if(r instanceof t)return r;if(e(r)){var n=a();return r.then(function(e){n.fulfill(e)},function(e){n.reject(e)}),n}return new t(r)}var l=this;"undefined"!=typeof window?(window.Local===void 0&&(window.Local={}),l=window.Local):"undefined"!=typeof self?(self.Local===void 0&&(self.Local={}),l=self.Local):"undefined"!=typeof module&&(l=module.exports),t.prototype.isUnfulfilled=function(){return!this.__hasValue},t.prototype.isRejected=function(){return this.__hasFailed},t.prototype.isFulfilled=function(){return this.__hasValue&&!this.__hasFailed},t.prototype.then=function(e,t){e=e&&"function"==typeof e?e:null,t=t&&"function"==typeof t?t:null;var n=a();if(this.isUnfulfilled())this.succeedCBs.push({p:n,fn:e}),this.failCBs.push({p:n,fn:t});else{var o=this;setTimeout(function(){o.isFulfilled()?r(o,n,e):r(o,n,t)},0)}return n},t.prototype.succeed=function(e){if(this.isRejected())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(function(r){return e.apply(null,[r].concat(t))})},t.prototype.fail=function(e){if(this.isFulfilled())return this;var t=Array.prototype.slice.call(arguments,1);return this.then(null,function(r){return e.apply(null,[r].concat(t))})},t.prototype.fulfill=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0;for(var t=0;this.succeedCBs.length>t;t++){var n=this.succeedCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.reject=function(e){if(this.isUnfulfilled()){this.value=e,this.__hasValue=!0,this.__hasFailed=!0;for(var t=0;this.failCBs.length>t;t++){var n=this.failCBs[t];r(this,n.p,n.fn)}this.succeedCBs.length=0,this.failCBs.length=0}return this},t.prototype.cancel=function(){var e;for(e=0;this.succeedCBs.length>e;e++)this.succeedCBs[e].p.cancel();for(e=0;this.failCBs.length>e;e++)this.failCBs[e].p.cancel();return this.succeedCBs.length=0,this.failCBs.length=0,this},t.prototype.chain=function(e){return this.then(function(t){return a(e).fulfill(t),t},function(t){return a(e).reject(t),t}),e},l.Promise=t,l.promise=a,l.promise.bundle=o,l.promise.all=i,l.promise.any=s,l.nodeStyleCB=n}(),"undefined"!=typeof define&&define([],function(){return Promise});var Link={};(function(e){function t(){this._events={}}function r(e){if(e&&"object"==typeof e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}function n(e){return e instanceof r?e:new r(e)}function o(e,t){if(!e||"object"!=typeof e||!t)return e;var r=l(t,"serializer");return r?r(e):e}function i(e,t){if(!e||"string"!=typeof e||!t)return e;var r=l(t,"deserializer");return r?r(e):e}function s(e,t,r){p[e]={serializer:t,deserializer:r}}function a(e){var t=e.split(";"),r=t[0];if(t=r.split("/"),t[1]){var n=t[1].split("+");return n[1]?[r,t[0]+"/"+n[1],t[0]]:[r,t[0]]}return[r]}function l(e,t){for(var r=a(e),n=0;r.length>n;n++)if(r[n]in p)return p[r[n]][t];return null}t.prototype.emit=function(e){var t=this._events[e];if(!t)return!1;for(var r=Array.prototype.slice.call(arguments,1),n=0,o=t.length;o>n;n++)t[n].apply(this,r);return!0},t.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if("function"!=typeof t)throw Error("addListener only takes instances of Function");return this.emit("newListener",e,t),this._events[e]?this._events[e].push(t):this._events[e]=[t],this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){var r=this;r.on(e,function n(){r.removeListener(e,n),t.apply(this,arguments)})},t.prototype.removeListener=function(e,t){if("function"!=typeof t)throw Error("removeListener only takes instances of Function");if(!this._events[e])return this;var r=this._events[e],n=r.indexOf(t);return 0>n?this:(r.splice(n,1),0===r.length&&delete this._events[e],this)},t.prototype.removeAllListeners=function(e){return e&&this._events[e]&&(this._events[e]=null),this},t.prototype.listeners=function(e){return this._events[e]},e.EventEmitter=t,r.prototype.addLink=function(e,t,r){var n=r||{};return n.href=e,n.rel=t,this.link||(this.link=[]),this.link.push(n),this},r.prototype.setAuth=function(e){return this.authorization=e,this},r.prototype.serialize=function(){if(this.link&&Array.isArray(this.link))throw"Link header serialization is not yet implemented";if(this.authorization&&"object"==typeof this.authorization){if(!this.authorization.scheme)throw"`scheme` required for auth headers";var e;switch(this.authorization.scheme.toLowerCase()){case"basic":e="Basic "+btoa(this.authorization.name+":"+this.authorization.password);break;case"persona":e="Persona name="+this.authorization.name+" assertion="+this.authorization.assertion;break;default:throw"unknown auth sceme: "+this.authorization.scheme}this.authorization=e}return this},e.Headerer=r,e.headerer=n,e.parseLinkHeader=function(e){return"string"!=typeof e?e:e.replace(/,[\s]*</g,"|||<").split("|||").map(function(e){var t={};return e.trim().split(";").forEach(function(e){if(e=e.trim())if("<"===e.charAt(0))t.href=e.trim().slice(1,-1);else{var r=e.split("="),n=r[0].trim(),o=r[1].trim().slice(1,-1);t[n]=o}}),t})},e.lookupLink=function(e,t,r){var n=e?e.length:0;if(!n)return null;r=r.toLowerCase();for(var o=null,i=0;n>i;i++){var s=e[i];if(s&&s.rel&&-1!==s.rel.indexOf(t))if(s.title){if(s.title.toLowerCase()===r){o=s;break}}else o=s}return o?o.href:null},e.joinUrl=function(){var e=Array.prototype.map.call(arguments,function(e){var t=0,r=e.length;return"/"===e.charAt(0)&&(t+=1),"/"===e.charAt(r-1)&&(r-=1),e.substring(t,r)});return e.join("/")},e.parseUri=function(t){"object"==typeof t&&(t.url?t=t.url:(t.host||t.path)&&(t=Link.joinUrl(req.host,req.path)));for(var r=e.parseUri.options,n=r.parser[r.strictMode?"strict":"loose"].exec(t),o={},i=14;i--;)o[r.key[i]]=n[i]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(e,t,n){t&&(o[r.q.name][t]=n)}),o},e.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var u={serialize:o,deserialize:i,register:s},p={};s("application/json",function(e){try{return JSON.stringify(e)}catch(t){return t.message}},function(e){try{return JSON.parse(e)}catch(t){return t.message}}),s("application/x-www-form-urlencoded",function(e){var t=encodeURIComponent,r=[];for(var n in e)if(null===e[n])r.push(n+"=");else if(Array.isArray(e[n]))for(var o=0;e[n].length>o;o++)r.push(n+"[]="+t(e[n][o]));else if("object"==typeof e[n])for(var i in e[n])r.push(n+"["+i+"]="+t(e[n][i]));else r.push(n+"="+t(e[n]));return r.join("&")},function(e){for(var t=e.split("&"),r={},n=0;t.length>n;n++){var o=t[n].split("="),i=decodeURIComponent(o[0]),s=decodeURIComponent(o[1]),a=/\[\]$/.test(i),l=i.match(/^(.+)\[([^\]]+)\]$/);if(l){i=l[1];var u=l[2];r[i]=r[i]||{},r[i][u]=s}else a?(i=i.substring(0,i.length-2),r[i]=r[i]||[],r[i].push(s)):r[i]=s}return r}),e.contentTypes=u})(Link),function(e){function t(e){e=e||{},e.headers=e.readers||{},this.message=""+e.status+": "+e.reason,this.response=e}function r(e){if(!e)throw"no req param provided to request";if(e.headers=e.headers||{},e.query=e.query||{},v)return v(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided in request";e.urld.protocol||(e.url=e.url.length>0&&"/"!=e.url.charAt(0)?window.location.protocol+"//"+window.location.host+y+e.url:window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url));var r=Local.promise();return"httpl"==e.urld.protocol?setTimeout(function(){n(e,r)},0):"http"==e.urld.protocol||"https"==e.urld.protocol?setTimeout(function(){o(e,r)},0):r.fulfill(new t({status:0,reason:'unsupported protocol "'+e.urld.protocol+'"'})),r}function n(e,r){var n=d[e.urld.host];if(!n){var o=new l(404,"server not found");return r.reject(new t(o)),o.end(),void 0}var i={path:e.urld.path,method:e.method,query:e.query||{},headers:e.headers||{},body:e.body,stream:e.stream};if(e.urld.query){var s=Link.contentTypes.deserialize(e.urld.query,"application/x-www-form-urlencoded");for(var a in s)i.query[a]=s[a]}n.fn.call(n.context,i,new u(r,e.stream))}function o(e,t){if(e.query){var r=Link.contentTypes.serialize(e.query,"application/x-www-form-urlencoded");r&&(e.urld.query?(e.urld.query+="&"+r,e.urld.relative+="&"+r):(e.urld.query=r,e.urld.relative+="?"+r))}"undefined"!=typeof window?i(e,t):s(e,t)}function i(e,r){var n=(e.urld.protocol?e.urld.protocol+"://":"")+e.urld.authority+e.urld.relative;e.headers=Link.headerer(e.headers).serialize(),null!==e.body&&e.body!==void 0&&(e.headers["content-type"]=e.headers["content-type"]||"application/json","string"!=typeof e.body&&(e.body=Link.contentTypes.serialize(e.body,e.headers["content-type"])));var o=new XMLHttpRequest;o.open(e.method,n,!0);for(var i in e.headers)null!==e.headers[i]&&e.headers.hasOwnProperty(i)&&o.setRequestHeader(i,e.headers[i]);var s,a=0,u=0;o.onreadystatechange=function(){if(o.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&!s&&(s=new l(o.status,o.statusText),o.getAllResponseHeaders().split("\n").forEach(function(e){if(e){var t=e.toLowerCase().replace("\r","").split(": ");s.headers[t[0]]=t[1]}}),s.headers.link&&(s.headers.link=Link.parseLinkHeader(s.headers.link)),e.stream&&(s.status>=200&&400>s.status?r.fulfill(s):s.status>=400&&600>s.status?r.reject(new t(s)):0===s.status?r.reject(new t({code:0,reason:"Remote connection refused by the host"})):r.reject(new t(s)),a=setInterval(function(){var e=o.responseText.length;e>u&&(u=e,s.write(o.responseText,!0))},e.streamPoll||500))),o.readyState===XMLHttpRequest.DONE){s=s||new l(o.status,o.statusText),a&&clearInterval(a);var n=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]);e.stream?s.write(n):(s.body=Link.contentTypes.deserialize(o.responseText,s.headers["content-type"]),s.status>=200&&400>s.status?r.fulfill(s):s.status>=400&&600>s.status?r.reject(new t(s)):0===s.status?r.reject(new t({code:0,reason:"Remote connection refused by the host"})):r.reject(new t(s))),s.end()}},o.send(e.body)}function s(e,t){var r=new l(0,"dispatch() has not yet been implemented for nodejs");t.reject(r),r.end()}function a(e){v=e}function l(e,t){Link.EventEmitter.call(this),this.status=e,this.reason=t,this.headers={},this.body=null,this.isConnOpen=!0}function u(e,t){Link.EventEmitter.call(this),this.resPromise=e,this.isStreaming=t,this.clientResponse=new l}function p(e,t,r){var n=Link.parseUri(e);if(n.protocol&&"httpl"!==n.protocol)throw"registerLocal can only add servers to the httpl protocol";if(!n.host)throw"invalid domain provided to registerLocal";if(d[n.host])throw"server already registered at domain given to registerLocal";d[n.host]={fn:t,context:r}}function c(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";d[t.host]&&delete d[t.host]}function h(e){var t=Link.parseUri(e);if(!t.host)throw"invalid domain provided toun registerLocal";return d[t.host]}function f(){return d}var d={},v=null,y="undefined"!=typeof window?window.location.pathname.split("/"):[""];y[y.length-1]="",y=y.join("/"),t.prototype=Error(),l.prototype=Object.create(Link.EventEmitter.prototype),l.prototype.write=function(e,t){if(t||"string"!=typeof e||"string"!=typeof this.body){var r=this.body&&"string"==typeof this.body?this.body.length:0;this.body=e,e="string"==typeof e?e.slice(r):e}else this.body+=e;this.emit("data",e)},l.prototype.end=function(){this.__deserialize(),this.isConnOpen=!1,this.emit("end")},l.prototype.__deserialize=function(){"string"==typeof this.body&&(this.body=Link.contentTypes.deserialize(this.body,this.headers["content-type"]))},u.prototype=Object.create(Link.EventEmitter.prototype),u.prototype.writeHead=function(e,t,r){this.clientResponse.status=e,this.clientResponse.reason=t;for(var n in r)r.hasOwnProperty(n)&&this.setHeader(n,r[n]);this.isStreaming&&this.__fulfillPromise()},u.prototype.setHeader=function(e,t){this.clientResponse.headers[e]=t},u.prototype.getHeader=function(e){return this.clientResponse.headers[e]},u.prototype.removeHeader=function(e){delete this.clientResponse.headers[e]},u.prototype.write=function(e){this.clientResponse.write(e,!1)},u.prototype.end=function(e){e&&this.write(e),this.isStreaming||(this.clientResponse.__deserialize(),this.__fulfillPromise()),this.clientResponse.end(),this.emit("close"),this.removeAllListeners("close"),this.clientResponse.removeAllListeners("data"),this.clientResponse.removeAllListeners("end")},u.prototype.__fulfillPromise=function(){this.clientResponse.status>=200&&400>this.clientResponse.status?this.resPromise.fulfill(this.clientResponse):this.clientResponse.status>=400&&600>this.clientResponse.status?this.resPromise.reject(new t(this.clientResponse)):this.resPromise.reject(new t(this.clientResponse))},u.prototype.writeContinue=noop,u.prototype.addTrailers=noop,u.prototype.sendDate=noop,e.ResponseError=t,e.dispatch=r,e.registerLocal=p,e.unregisterLocal=c,e.getLocal=h,e.getLocalRegistry=f,e.setRequestDispatcher=a,e.ClientResponse=l,e.ServerResponse=u}(Link),function(e){function t(e){if(!e)throw"no options provided to subscribe";if("string"==typeof e&&(e={url:e}),p)return p(e);if(e.urld=e.url?Link.parseUri(e.url):Link.parseUri(Link.joinUrl(e.host,e.path)),!e.urld)throw"no URL or host/path provided to subscribe";return e.urld.protocol||(e.url=window.location.protocol+"//"+window.location.host+e.url,e.urld=Link.parseUri(e.url)),"httpl"==e.urld.protocol?r(e):n(e)}function r(e){var t=new l(Link.dispatch({method:"get",url:"httpl://"+e.urld.authority+e.urld.relative,headers:{accept:"text/event-stream"},stream:!0}));return t}function n(e){return"undefined"!=typeof window?o(e):i(e)}function o(e){var t=(e.urld.protocol||"http")+"://"+e.urld.authority+e.urld.relative;return new u(t)}function i(){throw"subscribe() has not yet been implemented for nodejs"}function s(e){p=e}function a(){Link.EventEmitter.call(this),this.isConnOpen=!0}function l(e){a.call(this);var t=this;e.then(function(e){e.on("data",function(e){t.__emitEvent(e)}),e.on("end",function(){t.close()})},function(e){t.__emitError({event:"error",data:e}),t.close()})}function u(e){a.call(this),this.eventSource=new EventSource(e);var t=this;this.eventSource.onerror=function(e){e.target.readyState==EventSource.CLOSED&&t.close()}}var p=null;a.prototype=Object.create(Link.EventEmitter.prototype),a.prototype.close=function(){this.isConnOpen=!1,this.removeAllListeners()},a.prototype.__emitError=function(e){this.emit("message",e),this.emit("error",e)},a.prototype.__emitEvent=function(e){this.emit("message",e),this.emit(e.event,e)},l.prototype=Object.create(a.prototype),l.prototype.close=function(){this.__emitError({event:"error",data:void 0}),a.prototype.close.call(this)},u.prototype=Object.create(a.prototype),u.prototype.addListener=function(e,t){if(Array.isArray(e))return e.forEach(function(e){this.addListener(e,t)},this),void 0;if(!this._events[e]){var r=this;this.eventSource.addEventListener(e,function(e){var t=e.data;try{t=JSON.parse(t)}catch(n){}r.__emitEvent({event:e.type,data:t})})}Link.EventEmitter.prototype.addListener.call(this,e,t)},u.prototype.on=u.prototype.addListener,u.prototype.close=function(){this.eventSource.close(),this.eventSource.onerror=null,this.eventSource=null,a.prototype.close.call(this)},e.subscribe=t,e.setEventSubscriber=s,e.EventStream=a}(Link),function(e){function t(){return"undefined"!=typeof window?window.location.host:app?app.config.environmentHost:""}function r(e,t,n){this.rel=e,this.relparams=t,this.url=n,this.resolveState=r.UNRESOLVED,this.error=null}function n(e,t){if(this.context=e||null,this.parentNavigator=t||null,this.links=null,"string"==typeof this.context)this.context=new r(null,null,e);else if(!t)throw"parentNavigator is required for navigators with relative contexts"}function o(e){return e instanceof n?e:new n(e)}var i=["head","post","put","patch","delete"],s={Json:"application/json",Html:"text/html",Xml:"text/xml",Events:"text/event-stream",Eventstream:"text/event-stream",Plain:"text/plain",Text:"text/plain"},a=["alternate","author","collection","current","describedby","first","index","item","last","latest-version","monitor","monitor-group","next","next-archive","payment","predecessor-version","prev","prev-archive","related","replies","search","self","service","successor-version","up","version-history","via","working-copy","working-copy-of"];r.UNRESOLVED=0,r.RESOLVED=1,r.FAILED=2,r.prototype.isResolved=function(){return this.resolveState===r.RESOLVED},r.prototype.isBad=function(){return this.resolveState>1},r.prototype.isRelative=function(){return!this.url&&!!this.rel},r.prototype.isAbsolute=function(){return!!this.url},r.prototype.getUrl=function(){return this.url},r.prototype.getError=function(){return this.error},r.prototype.getHost=function(){if(!this.host){if(!this.url)return null;var e=Link.parseUri(this.url);this.host=(e.protocol||"http")+"://"+(e.authority||t())}return this.host},r.prototype.resetResolvedState=function(){this.resolveState=r.UNRESOLVED,this.error=null},r.prototype.resolve=function(e){this.error=null,this.resolveState=r.RESOLVED,this.url=e;var t=Link.parseUri(this.url);this.host=(t.protocol||"http")+"://"+t.authority},n.prototype.dispatch=function(e){if(!e||!e.method)throw"request options not provided";var t=this,n=Local.promise();return(e.noresolve?Local.promise(this.context.getUrl()):this.resolve({retry:e.retry})).succeed(function(o){e.url=o,Link.dispatch(e).succeed(function(e){return t.context.error=null,t.context.resolveState=r.RESOLVED,t.links=e.headers.link?e.headers.link:t.links||[],e}).fail(function(e){throw 404===e.response.status&&(t.context.error=e,t.context.resolveState=r.FAILED),e}).chain(n)}).fail(function(e){n.reject(e)}),n},n.prototype.subscribe=function(){return this.resolve().succeed(function(e){return Link.subscribe(e)})},n.prototype.relation=function(e,t,o){var i=o||{};return i.title=(t||"").toLowerCase(),new n(new r(e,i),this)},n.prototype.resolve=function(e){var t=this,r=Local.promise();return null!==this.links&&(this.context.isResolved()||this.context.isAbsolute()&&this.context.isBad()===!1)?r.fulfill(this.context.getUrl()):this.context.isBad()===!1||this.context.isBad()&&e.retry?(this.context.resetResolvedState(),this.parentNavigator?this.parentNavigator.__resolveChild(this,e).then(function(e){var r=Local.promise();return t.head(null,null,null,{noresolve:!0}).then(function(){r.fulfill(e)},function(e){r.reject(e)}),r}).chain(r):this.head(null,null,null,{noresolve:!0}).then(function(){return t.context.getUrl()}).chain(r)):r.reject(this.context.getError()),r},n.prototype.__resolveChild=function(e,t){var n=this,o=Local.promise();return this.resolve(t).then(function(){var t=n.__lookupLink(e.context);t?(e.context.resolve(t),o.fulfill(t)):o.reject(new Link.ResponseError({status:404,reason:"link relation not found"}))},function(t){return e.context.error=t,e.context.resolveState=r.FAILED,o.reject(t),t}),o},n.prototype.__lookupLink=function(e){var t=Link.lookupLink(this.links,e.rel,e.relparams.title);if(t){var r=Link.UriTemplate.parse(t).expand(e.relparams),n=Link.parseUri(r);return n.host||(r=this.context.getHost()+n.relative),r}return console.log("Failed to find a link to resolve context. Target link:",e.rel,e.relparams,"Navigator:",this),null},i.forEach(function(e){n.prototype[e]=function(t,r,n,o){var i=o||{};return i.headers=n||{},i.method=e,null!==t&&"null"!=typeof t&&/head/i.test(e)===!1&&(i.headers["content-type"]=r||("object"==typeof t?"application/json":"text/plain")),i.body=t,this.dispatch(i)}}),n.prototype.get=function(e,t,r){var n=r||{};return n.headers=t||{},n.method="get",n.headers.accept=e,this.dispatch(n)};for(var l in s)(function(e,t){n.prototype["get"+e]=function(e,r){return this.get(t,e,r)}})(l,s[l]);a.forEach(function(e){var t=e.replace(/-/g,"_");n.prototype[t]=function(t,r){return this.relation(e,t,r)}}),e.navigator=o,e.Navigator=n}(Link),function(e){"use strict";function t(e){return"[object Array]"===Object.prototype.toString.apply(e)}function r(e,t,r){var n,o=r;for(n in e)e.hasOwnProperty(n)&&(o=t(o,e[n],n,e));return o}function n(e,t,r){var n,o=r;for(n=0;e.length>n;n+=1)o=t(o,e[n],n,e);return o}function o(e,o,i){return t(e)?n(e,o,i):r(e,o,i)}function i(e){var r,n;if(null===e||void 0===e)return!1;if(t(e)){for(r=0;e.length>r;r+=1)if(i(e[r]))return!0;return!1}if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return!0;for(n in e)if(e.hasOwnProperty(n)&&i(e[n]))return!0;return!1}function s(e){return e>="a"&&"z">=e||e>="A"&&"Z">=e}function a(e){return e>="0"&&"9">=e}function l(e){return a(e)||e>="a"&&"f">=e||e>="A"&&"F">=e}function u(e){return s(e)||a(e)||"_"===e||w.isPctEncoded(e)}function p(e){return s(e)||a(e)||"-"===e||"."===e||"_"===e||"~"===e}function c(e){return":"===e||"/"===e||"?"===e||"#"===e||"["===e||"]"===e||"@"===e||"!"===e||"$"===e||"&"===e||"("===e||")"===e||"*"===e||"+"===e||","===e||";"===e||"="===e||"'"===e}function h(e,t){var r,n="",o="";for(("number"==typeof e||"boolean"==typeof e)&&(e=""+e),r=0;e.length>r;r+=o.length)o=w.pctCharAt(e,r),n+=o.length>1?o:p(o)||t&&c(o)?o:w.encodeCharacter(o);return n}function f(e){return h(e,!0)}function d(e,t){this.templateText=e,this.expressions=t}function v(e){var t,r="",n="";for(t=0;e.length>t;t+=n.length)n=w.pctCharAt(e,t),r+=n.length>0?n:c(n)||p(n)?n:w.encodeCharacter(n);return r}function y(e){this.literal=v(e)}function m(e,t,r){this.templateText=e,this.operator=t,this.varspecs=r}function g(e){function t(){p={varname:n.substring(c,i),exploded:!1,maxLength:null},c=null}function r(){if(h===i)throw Error("after a ':' you have to specify the length. position = "+i);p.maxLength=parseInt(n.substring(h,i),10),h=null}var n,o,i,s,l=[],p=null,c=null,h=null;for(n=e.substr(1,e.length-2),i=0;n.length>i;i+=s.length){if(s=w.pctCharAt(n,i),0===i){if(o=L.valueOf(s),""!==o.symbol){c=1;continue}c=0}if(null!==c){if("."===s){if(c===i)throw Error("a varname MUST NOT start with a dot -- see position "+i);continue}if(u(s))continue;t()}if(null!==h){if(a(s))continue;r()}if(":"!==s)if("*"!==s){if(","!==s)throw Error("illegal character '"+s+"' at position "+i);l.push(p),p=null,c=i+1}else{if(null===p)throw Error("explode exploded at position "+i);if(p.exploded)throw Error("explode exploded twice at position "+i);if(p.maxLength)throw Error("an explode (*) MUST NOT follow to a prefix, see position "+i);p.exploded=!0}else{if(null!==p.maxLength)throw Error("only one :maxLength is allowed per varspec at position "+i);h=i+1}}return null!==c&&t(),null!==h&&r(),l.push(p),new m(e,o,l)}var w=function(){function e(e){return unescape(encodeURIComponent(e))}function t(t){var r,n,o="",i=e(t);for(n=0;i.length>n;n+=1)r=i.charCodeAt(n),o+="%"+r.toString(16).toUpperCase();return o}function r(e){if(3>e.length)return!1;for(var t=0;e.length>t;t+=3)if("%"!==e.charAt(t)||!l(e.charAt(t+1)||!l(e.charAt(t+2))))return!1;return!0}function n(e,t){var n=e.charAt(t);return"%"!==n?n:(n=e.substr(t,3),r(n)?n:"%")}return{encodeCharacter:t,decodeCharacter:decodeURIComponent,isPctEncoded:r,pctCharAt:n}}(),L=function(){function e(e){t[e]={symbol:e,separator:"?"===e?"&":""===e||"+"===e||"#"===e?",":e,named:";"===e||"&"===e||"?"===e,ifEmpty:"&"===e||"?"===e?"=":"",first:"+"===e?"":e,encode:"+"===e||"#"===e?f:h,toString:function(){return this.symbol}}}var t={};return e(""),e("+"),e("#"),e("."),e("/"),e(";"),e("?"),e("&"),{valueOf:function(e){if(t[e])return t[e];if("=,!@|".indexOf(e)>=0)throw Error('Illegal use of reserved operator "'+e+'"');return t[""]}}}();d.prototype.toString=function(){return this.templateText},d.prototype.expand=function(e){var t,r="";for(t=0;this.expressions.length>t;t+=1)r+=this.expressions[t].expand(e);return r},y.prototype.expand=function(){return this.literal},y.prototype.toString=y.prototype.expand,m.prototype.toString=function(){return this.templateText},m.prototype.expand=function(e){function r(e,t,r){return i(t)&&(e.length>0&&(e+=","),p||(e+=f.encode(r)+","),e+=f.encode(t)),e}function n(e,t,r){return i(t)&&(e.length>0&&(e+=f.separator),e+=p?v(l.varname):f.encode(r),e+="="+f.encode(t)),e}function s(e,t,r){return i(t)&&(e.length>0&&(e+=f.separator),p||(e+=f.encode(r)+"="),e+=f.encode(t)),e}var a,l,u,p,c="",h=!0,f=this.operator;for(a=0;this.varspecs.length>a;a+=1)if(l=this.varspecs[a],u=e[l.varname],i(u))if(h?(c+=this.operator.first,h=!1):c+=this.operator.separator,p=t(u),"string"==typeof u||"number"==typeof u||"boolean"==typeof u){if(u=""+u,this.operator.named){if(c+=v(l.varname),""===u){c+=this.operator.ifEmpty;continue}c+="="}l.maxLength&&u.length>l.maxLength&&(u=u.substr(0,l.maxLength)),c+=this.operator.encode(u)}else{if(l.maxLength)throw Error("Prefix modifiers are not applicable to variables that have composite values. You tried to expand "+this+" with "+JSON.stringify(u));if(l.exploded)c+=o(u,f.named?n:s,"");else{if(f.named){if(c+=v(l.varname),!i(u)){c+=this.operator.ifEmpty;continue}c+="="}c+=o(u,r,"")}}return c},d.parse=function(e){var t,r,n=[],o=null,i=0;for(t=0;e.length>t;t+=1)if(r=e.charAt(t),null===i){if(null===o)throw Error("reached unreachable code");if("{"===r)throw Error("brace was opened in position "+o+" and cannot be reopened in position "+t);if("}"===r){if(o+1===t)throw Error("empty braces on position "+o);n.push(g(e.substring(o,t+1))),o=null,i=t+1}}else{if("}"===r)throw Error("brace was closed in position "+t+" but never opened");"{"===r&&(t>i&&n.push(new y(e.substring(i,t))),i=null,o=t)}if(null!==o)throw Error("brace was opened on position "+o+", but never closed");return e.length>i&&n.push(new y(e.substr(i))),new d(e,n)},e.UriTemplate=d}(Link),"undefined"!=typeof module?module.exports=Link:"undefined"!=typeof define&&define([],function(){return Link}),Link.setRequestDispatcher(function(e){if("function"==typeof e)return localApp.logStack();var t=Local.promise();return localApp.postMessage("httpRequest",e,function(r){if(!r.data)throw"Invalid httpRequest reply to worker from document";var n=new Link.ClientResponse(r.data.status,r.data.reason);n.headers=r.data.headers,e.stream||null===r.data.body||void 0===r.data.body||n.write(r.data.body),n.status>=200&&300>n.status?t.fulfill(n):(n.status>=400&&600>n.status||!n.status)&&t.reject(new Link.ResponseError(n)),e.stream&&null!==r.data.body&&r.data.body!==void 0&&n.write(r.data.body),localApp.onMessage(r.id,function(e){"endMessage"===e.name?n.end():n.write(e.data)})}),t}),Link.setEventSubscriber(function(e){var t=new Link.EventStream,r=localApp.postMessage("httpSubscribe",e);return t.addListener=t.on=function(e,t){localApp.postMessage(r,e,function(e){localApp.onMessage(e.id,function(e){t(e.data)})})},t}),localApp.onHttpRequest=function(e,t){localApp.httpRequestHandler=t?function(){return e.apply(t,arguments)}:e},localApp.setServer=function(e){"function"==typeof e&&(e=new e(arguments[1]||{})),e.config=localApp.config,localApp.onHttpRequest(e.handleHttpRequest,e)},localApp.onMessage("httpRequest",function(e){var t=e.data;if(localApp.httpRequestHandler){var r=function(t){var r=localApp.postReply(e,t);t.on("data",function(e){localApp.postMessage(r,e)}),t.on("end",function(){localApp.endMessage(r)})},n=function(e){r(e.response)},o=Local.promise();o.then(r,n);var i=new Link.ServerResponse(o,t.stream);localApp.httpRequestHandler(t,i)}else{var s=localApp.postReply(e,{status:404,reason:"Server not loaded"});localApp.endMessage(s)}}),localApp.Server=function(){},localApp.Server.prototype.handleHttpRequest=function(e,t){t.writeHead(0,"server not implemented"),t.end()};